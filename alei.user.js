// ==UserScript==
// @name ALE Improvements
// @description Changes to make ALE better.
// @version 19.8
// @author molis, mici1234, wanted2001, gcp5o
// @match *://www.plazmaburst2.com/level_editor/map_edit.php*
// @connect github.com
// @connect githubusercontent.com
// @downloadURL https://github.com/Molisson/ALEI/raw/main/alei.user.js
// @grant GM.xmlHttpRequest
// @icon https://github.com/Molisson/ALEI/blob/main/icon.png?raw=true
// @run-at document-start
// @updateURL https://github.com/Molisson/ALEI/raw/main/alei.user.js
// ==/UserScript==

(()=>{"use strict";var __webpack_modules__={381:(e,t,n)=>{n.d(t,{A:()=>l});var o=n(601),i=n.n(o),a=n(314),r=n.n(a)()(i());r.push([e.id,"/*todo: rename these first ones to follow BEM naming methodology*/\n.ALEI_settingMenuText {\n    font-size: 14px;\n    width: 150px;\n    height: 20px;\n    background-color: #476082;\n    color: #bfcad9;\n    border-radius: 4px;\n    text-align: center;\n    display: inline-block;\n}\n\n.ALEI_settingsMenuButton {\n    background-color: #26354a;\n    color: #c1c9d3;\n    border-radius: 5px;\n    border: 1px solid #26354a;\n    width: 80px;\n    height: 20px;\n    font-size: 14px;\n    text-align: center;\n    display: inline-block;\n    margin-right: 4px;\n}\n\n.ALEI_settingsMenuButton:hover {\n    background-color: #596a83;\n    color: #f5faff;\n}\n\n.ALEI_settingMenuButtonClicked {\n    background-color: #91a5c1;\n    color: #fbfbfb;\n}\n\n#alei-tooltip {\n    font-size: 16px;\n    font-family: monospace;\n    color: #eee;\n    background-color: #000;\n    padding: 10px;\n    width: fit-content;\n    border-radius: 4px;\n    word-break: break-all;\n    position: absolute;\n    left: 100px;\n    top: -100px;\n}\n\n#gui-render-info {\n    margin-left: 18px;\n}\n\n.gui-render-info__text {\n    padding: 0;\n    margin: 0;\n}",""]);const l=r},80:(e,t,n)=>{n.d(t,{A:()=>l});var o=n(601),i=n.n(o),a=n(314),r=n.n(a)()(i());r.push([e.id,'.alei-comment-box {\n    background-color: var(--comment-background-color);\n    width: 100%;\n    box-sizing: border-box;\n    border: 2px solid var(--comment-border-color);\n    margin: 2px 0px;\n    padding: 4px;\n    overflow: hidden;\n}\n\n.alei-comment-box__text-element {\n    color: var(--comment-color);\n    font-size: 11px;\n    font-family: "Liberation Mono", "Courier New", monospace;\n    font-style: italic;\n    line-height: 1.5em;\n}\n\n.alei-comment-box__prefix {\n    width: 20px;\n    float: left;\n    white-space: pre-wrap;\n}\n\n.alei-comment-box__text-area {\n    width: calc(100% - 20px); /* - prefix width*/\n    resize: none;\n    scrollbar-width: none; /*necessary to fix a weird bug with auto resize*/\n    padding: 0;\n    background: none;\n    border: none;\n}\n\n.alei-comment-adder-button {\n    color: var(--comment-adder-button-color);\n}\n\n.alei-comment-remover-button {\n    color: var(--comment-remover-button-color);\n}',""]);const l=r},584:(e,t,n)=>{n.d(t,{A:()=>l});var o=n(601),i=n.n(o),a=n(314),r=n.n(a)()(i());r.push([e.id,"/*\nthese padding and margin changes have almost no visual effect except for allowing comment buttons to bypass overflow: hidden on the x-axis\n*/\n#right_panel .rightui_cntnt {\n    padding-left: 0px; /* normally 14px*/\n}\n\n#objboxhider {\n    margin-left: 18px;\n    width: calc(100% - 18px);\n}\n\n#gui_objbox {\n    margin-left: 18px;\n}\n\n#gui_sel_info {\n    padding-left: 18px;\n}\n\n#rparams {\n    padding-left: 18px;\n    position: relative; /*setting position to relative so the comment elements can be absolutely positioned inside of it*/\n}\n\n\n\n#mrdimlights {\n    z-index: 200;\n}\n\n.mrpopup {\n    z-index: 300;\n}",""]);const l=r},679:(e,t,n)=>{n.d(t,{A:()=>l});var o=n(601),i=n.n(o),a=n(314),r=n.n(a)()(i());r.push([e.id,".alei-param-side-buttons-container {\n    width: 18px;\n    height: 60px;\n    position: absolute;\n    left: 1px;\n    display: none;\n}\n\n.alei-param-side-buttons-container--visible {\n    display: block;\n}\n\n.alei-param-side-buttons-container:hover .alei-param-side-button {\n    opacity: 100%;\n}\n\n.alei-param-side-button {\n    color: #f0f0f0;\n    background-color: var(--param-side-button-background-color);\n    border: none;\n    border-radius: 2px;\n    font-size: 11px;\n    font-weight: bold;\n    display: block;\n    width: 15px;\n    height: 15px;\n    padding: 0;\n    opacity: 40%;\n    margin-top: 1px;\n}\n\n.alei-param-side-button:hover {\n    background-color: var(--param-side-button-hover-background-color);\n}\n\n.alei-param-side-button:active {\n    background-color: var(--param-side-button-active-background-color);\n}",""]);const l=r},320:(e,t,n)=>{n.d(t,{A:()=>l});var o=n(601),i=n.n(o),a=n(314),r=n.n(a)()(i());r.push([e.id,":root, .blue-theme {\n    --param-side-button-background-color: #212429;\n    --param-side-button-hover-background-color: #223146;\n    --param-side-button-active-background-color: #2e3e53;\n    --comment-background-color: #314664;\n    --comment-border-color: #41546f;\n    --comment-color: #5a92df;\n    --comment-adder-button-color: #2781fb;\n    --comment-remover-button-color: #aa0000;\n}\n\n.dark-theme, .purple-theme, .green-theme {\n    --param-side-button-background-color: #2d2d2d;\n    --param-side-button-hover-background-color: #3b3b3b;\n    --param-side-button-active-background-color: #494949;\n    --comment-background-color: #292929;\n    --comment-border-color: #494949;\n    --comment-color: #7b7b7b;\n    --comment-adder-button-color: #8d8d8d;\n    --comment-remover-button-color: #a30b0b;\n}\n\n/*this is unused cuz theme changing needs to be reworked first*/\n.alei-dark-theme {\n    --warning-go-away-pls: 0;\n}",""]);const l=r},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,o,i,a){"string"==typeof e&&(e=[[null,e,void 0]]);var r={};if(o)for(var l=0;l<this.length;l++){var s=this[l][0];null!=s&&(r[s]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);o&&r[d[0]]||(void 0!==a&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=a),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),i&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=i):d[4]="".concat(i)),t.push(d))}},t}},601:e=>{e.exports=function(e){return e[1]}},421:(e,t,n)=>{var o=n(72),i=n.n(o),a=n(825),r=n.n(a),l=n(659),s=n.n(l),c=n(868),d=n.n(c),p=n(540),m=n.n(p),u=n(113),_=n.n(u),g=n(381),h={attributes:{title:"style-from-webpack"}};h.styleTagTransform=_(),h.setAttributes=d(),h.insert=s().bind(null,"head"),h.domAPI=r(),h.insertStyleElement=m(),i()(g.A,h),g.A&&g.A.locals&&g.A.locals},888:(e,t,n)=>{var o=n(72),i=n.n(o),a=n(825),r=n.n(a),l=n(659),s=n.n(l),c=n(868),d=n.n(c),p=n(540),m=n.n(p),u=n(113),_=n.n(u),g=n(80),h={attributes:{title:"style-from-webpack"}};h.styleTagTransform=_(),h.setAttributes=d(),h.insert=s().bind(null,"head"),h.domAPI=r(),h.insertStyleElement=m(),i()(g.A,h),g.A&&g.A.locals&&g.A.locals},472:(e,t,n)=>{var o=n(72),i=n.n(o),a=n(825),r=n.n(a),l=n(659),s=n.n(l),c=n(868),d=n.n(c),p=n(540),m=n.n(p),u=n(113),_=n.n(u),g=n(584),h={attributes:{title:"style-from-webpack"}};h.styleTagTransform=_(),h.setAttributes=d(),h.insert=s().bind(null,"head"),h.domAPI=r(),h.insertStyleElement=m(),i()(g.A,h),g.A&&g.A.locals&&g.A.locals},663:(e,t,n)=>{var o=n(72),i=n.n(o),a=n(825),r=n.n(a),l=n(659),s=n.n(l),c=n(868),d=n.n(c),p=n(540),m=n.n(p),u=n(113),_=n.n(u),g=n(679),h={attributes:{title:"style-from-webpack"}};h.styleTagTransform=_(),h.setAttributes=d(),h.insert=s().bind(null,"head"),h.domAPI=r(),h.insertStyleElement=m(),i()(g.A,h),g.A&&g.A.locals&&g.A.locals},24:(e,t,n)=>{var o=n(72),i=n.n(o),a=n(825),r=n.n(a),l=n(659),s=n.n(l),c=n(868),d=n.n(c),p=n(540),m=n.n(p),u=n(113),_=n.n(u),g=n(320),h={attributes:{title:"style-from-webpack"}};h.styleTagTransform=_(),h.setAttributes=d(),h.insert=s().bind(null,"head"),h.domAPI=r(),h.insertStyleElement=m(),i()(g.A,h),g.A&&g.A.locals&&g.A.locals},72:e=>{var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var a={},r=[],l=0;l<e.length;l++){var s=e[l],c=o.base?s[0]+o.base:s[0],d=a[c]||0,p="".concat(c," ").concat(d);a[c]=d+1;var m=n(p),u={css:s[1],media:s[2],sourceMap:s[3],supports:s[4],layer:s[5]};if(-1!==m)t[m].references++,t[m].updater(u);else{var _=i(u,o);o.byIndex=l,t.splice(l,0,{identifier:p,updater:_,references:1})}r.push(p)}return r}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var a=o(e=e||[],i=i||{});return function(e){e=e||[];for(var r=0;r<a.length;r++){var l=n(a[r]);t[l].references--}for(var s=o(e,i),c=0;c<a.length;c++){var d=n(a[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}a=s}}},659:e=>{var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},868:e=>{e.exports=function(e,t){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,i&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var a=n.sourceMap;a&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},186:(e,t,n)=>{n.d(t,{Or:()=>p,un:()=>g,zj:()=>m,jY:()=>_,nG:()=>u});const o="::ALEI Map Data (important!)::",i="::ALEI Map Data backup::";function a(){for(let e of es)if(e.pm.uid==o&&"decor"==e._class&&e.exists)return e;return null}function r(e,t){e.pm.text=JSON.stringify(t).replaceAll('"',"&quot;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("\\","&bs;")}const l=1,s={2:function(e){throw new Error("mapDataFormatUpdateFunctions[2] not implemented")}};const c={v:l,content:{comments:{}}};let d;function p(){const e=a();if(null===e)g();else{d=function(e){return JSON.parse(e.pm.text.replaceAll("&quot;",'"').replaceAll("&lt;","<").replaceAll("&gt;",">").replaceAll("&bs;","\\"))}(e);const t=function(e){return e.v==l}(d);t||function(e){!function(e){let t=new E("decor");t.pm.uid=i,t.pm.model="null",r(t,e),es.push(t),need_redraw=!0,UpdateGUIObjectsList()}(e);for(let t=e.v;t<l;t++){let n=t+1,o=s[n];if(null==o)throw NewNote("ALEI: An error occured while updating ALEI map data.<br>Report this problem to the developers and disable ALEI if the problem persists.",note_bad),new Error(`v.${t} -> v.${n} map data update function doesn't exist`);o(e)}}(d)}}function m(){for(const e in d.content.comments){const t=d.content.comments[e];let n=0;for(const o of es)if("trigger"==o._class&&o.exists&&o.pm.uid==e&&(o.comments=t[n],n++,n==t.length))break}}function u(){d.content.comments={};for(const e of es){if("trigger"!=e._class||!e.exists||void 0===e.comments)continue;const t=e.pm.uid;void 0===d.content.comments[t]&&(d.content.comments[t]=new Array);let n={};const o=!0===e.pm.extended?e.pm.totalNumOfActions:10;for(const t in e.comments)parseInt(t)<o&&(n[t]=e.comments[t]);d.content.comments[t].push(n)}}function _(){const e=a();null!=e?r(e,d):Object.keys(d.content.comments).length>0&&function(e){let t=new E("decor");t.pm.uid=o,t.pm.model="null",r(t,e),es.push(t),need_redraw=!0,UpdateGUIObjectsList()}(d)}function g(){d=JSON.parse(JSON.stringify(c))}g(),unsafeWindow.RemoveALEIMapData=function(){!function(){for(const e of es)"trigger"==e._class&&e.exists&&void 0!==e.comments&&delete e.comments}(),unsafeWindow.SaveThisMap()}},606:(e,t,n)=>{n.d(t,{Z:()=>a,a:()=>i});var o=n(186);function i(){const e=unsafeWindow.SaveThisMap;unsafeWindow.SaveThisMap=function(t="",n=null){(0,o.nG)(),(0,o.jY)(),e(t,n)}}function a(){const e=unsafeWindow.StartNewMap;unsafeWindow.StartNewMap=function(){e(),(0,o.un)()}}},338:(e,t,n)=>{function o(e){let t=0;return(!isNaN(Number(e))&&" "!==e||"."==e)&&(t=1),t}function i(e){return"+-*/%^SCANRF".includes(e)}function a(e){return"()".includes(e)}function r(e){let t=0;return"+-".includes(e)&&(t=1),"*/%".includes(e)&&(t=2),"^SCANRF".includes(e)&&(t=3),t}function l(e,t,n){let o;return e=Number(e),n=Number(n),"+"==t&&(o=e+n),"-"==t&&(o=e-n),"*"==t&&(o=e*n),"/"==t&&(o=e/n),"%"==t&&(o=e%n),"^"==t&&(o=e**n),"S"==t&&(o=Math.sin(e)*n),"C"==t&&(o=Math.cos(e)*n),"A"==t&&(o=Math.atan2(e,n)),"N"==t&&(o=n?Math.floor(Math.random()*e):Math.random()*e),"R"==t&&(o=Math.round(e/n)*n),"F"==t&&(o=Math.floor(e/n)*n),o}function s(e,t){""==e&&(e="0"),"-"==e[0]&&(e="0"+e),function(e){let t="";for(let n=0;n<e.length;n++)o(e[n])?t+=e[n]:0!=t.length&&(e.splice(n-t.length,t.length,t),n-=t.length-1,t="");0!=t.length&&e.splice(e.length-t.length,t.length,t)}(e=function(e){return e.replaceAll(" ","").split("")}(e)),function(e,t){for(let n=0;n<e.length;n++)for(let o=0;o<t.length;o++)e[n]==t[o].from&&(e[n]=t[o].to)}(e,[{from:"p",to:String(Math.PI)},{from:"x",to:String(t[0])},{from:"y",to:String(t[1])},{from:"w",to:String(t[2])},{from:"h",to:String(t[3])},{from:"i",to:String(t[4])}]);try{!function(e){for(let t=0;t<e.length;t++)"-"==e[t]&&"("==e[t-1]&&e.splice(t,0,"0")}(e),function(e){for(let t=0;t<e.length;t++)"("==e[t-1]&&")"==e[t+1]&&e.splice(t,0,"0","+")}(e),function(e){for(let t=0;t<e.length;t++)e[t]={chr:e[t]}}(e),function(e){let t=1;for(let n=0;n<e.length;n++)"("==e[n].chr&&t++,")"==e[n].chr&&t--,e[n].groupOrder=t}(e),function(e){for(let t=0;t<e.length;t++)a(e[t].chr)&&(e.splice(t,1),t--)}(e),function(e){for(let t=0;t<e.length;t++)if(i(e[t].chr)){let n=r(e[t].chr);e[t].operatorOrder=n,e[t+1].groupOrder==e[t].groupOrder&&(e[t+1].operatorOrder=n),(!e[t-1].operatorOrder||e[t-1].operatorOrder<e[t].operatorOrder&&e[t-1].groupOrder==e[t].groupOrder)&&(e[t-1].operatorOrder=n)}}(e),function(e){for(let t=0;t<e.length;t++)e[t].order=10*e[t].groupOrder+e[t].operatorOrder}(e),function(e){let t=function(e){let t=[];for(let n=0;n<e.length;n++)t.push(e[n].order);return t}(e),n=function(e){let t=[],n=1;e.sort(((e,t)=>t-e)),t.push({from:e[0],to:n});for(let o=1;o<e.length;o++)e[o]!=e[o-1]&&n++,t.push({from:e[o],to:n});return t}(t);for(let t=0;t<e.length;t++)for(let o=0;o<n.length;o++)e[t].order==n[o].from&&(e[t].order=n[o].to)}(e),function(e){let t=function(e){let t=0;for(let n=0;n<e.length;n++)e[n].order>t&&(t=e[n].order);return t}(e);for(let n=1;n<=t;n++){let t=0,o=1;for(;o;){o=0;let i,a,r=[],s=-1;for(;t<e.length;t++)if(e[t].order==n)r.push(e[t]),-1==s&&(s=t);else if(0!=r.length){o=1;break}if(i=r.length,i){for(;1!=r.length;)r.splice(0,3,{chr:l(r[0].chr,r[1].chr,r[2].chr)});a=e[s].order,e.splice(s,i,r[0]),t-=i-1,e[s]={chr:e[s].chr,order:a+1}}}}}(e)}catch{return"error"}return Number(Number(e[0].chr).toFixed(10))}n.d(t,{q:()=>s})},964:(e,t,n)=>{n.d(t,{L:()=>r,R:()=>l});var o=n(78),i=n(209),a=n(523);function r(){const e=s;(0,o.I)("commentAdderButton","alei-comment-adder-button","//+","Add comment above",e,{trigger:{triggerActionsItem:{type:"trigger actions"}}},!1,(e=>!(0,i.oU)(e.selectionData.objs[0],e.actionNum-1)))}function l(){const e=c;(0,o.I)("commentRemoverButton","alei-comment-remover-button","X","Remove comment",e,{trigger:{".alei-comment-box":{type:"elements"}}},!1)}function s(e){const t=e.selectionData.objs[0],n=e.actionNum-1;(0,i.fL)(t,n,i.E1);const o=document.getElementById("rparams"),r=(0,a.Db)(n),l=e.elements[0];o.insertBefore(r,l),(0,a.Fd)(r);const s=document.createElement("div");s.style.height="2px",o.insertBefore(s,l)}function c(e){const t=e.selectionData.objs[0],n=e.elements[0].getAttribute("position");(0,i.wI)(t,n);const o=e.elements[0];o.previousElementSibling.remove(),o.remove()}},209:(e,t,n)=>{n.d(t,{Ah:()=>a,E1:()=>o,Wq:()=>s,fL:()=>i,oU:()=>c,rw:()=>l,wI:()=>r});const o="";function i(e,t,n){void 0===e.comments&&(e.comments={}),e.comments[t]=n}function a(e,t,n){c(e,t)&&(e.comments[t]=n)}function r(e,t){delete e.comments[t],0==Object.keys(e.comments).length&&delete e.comments}function l(e,t){return e.comments[t]}function s(e){return function(e){return void 0!==e.comments}(e)?Object.keys(e.comments).map((e=>parseInt(e))):[]}function c(e,t){return void 0!==e.comments&&void 0!==e.comments[t]}},523:(e,t,n)=>{n.d(t,{Db:()=>m,Fd:()=>u,Gg:()=>d,gI:()=>p});var o=n(209);const i="//",a=16.5;let r,l=null;const s=new ResizeObserver((()=>{clearTimeout(l),l=setTimeout(c,200)}));function c(){l=null;const e=document.getElementById("rparams");if(null!==e){const t=e.querySelectorAll(".alei-comment-box");for(const e of t){const t=e.querySelector(".alei-comment-box__prefix"),n=e.querySelector(".alei-comment-box__text-area");_(n),g(n,t)}}}function d(e){r=e}function p(e){s.disconnect(),s.observe(e)}function m(e){const t=document.createElement("span");t.classList.add("alei-comment-box__text-element","alei-comment-box__prefix");const n=document.createElement("textarea");n.classList.add("alei-comment-box__text-element","alei-comment-box__text-area"),n.setAttribute("autocomplete","off"),n.setAttribute("autocorrect","off"),n.setAttribute("spellcheck","false");const i=document.createElement("div");i.className="alei-comment-box",i.setAttribute("position",e),i.appendChild(t),i.appendChild(n),n.addEventListener("input",function(){let e;const o=r;return function(){e&&clearTimeout(e),e=setTimeout((()=>{h(i,o)}),1e3),function(e,t){_(e),g(e,t)}(n,t)}}()),n.addEventListener("focusout",function(){const e=r;return()=>{h(i,e)}}());const a=(0,o.rw)(r,i.getAttribute("position"));return n.value=a,i}function u(e){const t=e.querySelector(".alei-comment-box__prefix"),n=e.querySelector(".alei-comment-box__text-area");_(n),g(n,t)}function _(e){e.style.height="auto",e.style.height=e.scrollHeight}function g(e,t){const n=Math.floor(e.scrollHeight/a);let o=`${i}\n`.repeat(n);o=o.slice(0,-1),t.textContent=o}function h(e,t){const n=e.getAttribute("position"),i=e.querySelector(".alei-comment-box__text-area").value;(0,o.Ah)(t,n,i)}},342:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>fixWebpackStyleSheets,O:()=>patchThemeSet});var _static_themes_css__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(24),_static_paramsidebuttons_css__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(663),_static_overridestyles_css__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(472),_static_aleistyles_css__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(421),_static_comments_css__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(888);const webpackStylesheetName="style-from-webpack",themes={0:"blue-theme",1:"dark-theme",2:"purple-theme",3:"green-theme",4:"alei-dark-theme"};function patchThemeSet(){const e=unsafeWindow.ThemeSet;unsafeWindow.ThemeSet=function(t){const n=themes[THEME],o=themes[t];document.body.classList.remove(n),document.body.classList.add(o),e(t)}}function fixWebpackStyleSheets(){for(let e=0;e<document.styleSheets.length;e++)document.styleSheets[e].title==webpackStylesheetName&&(document.styleSheets[e].disabled=!1);fixBullshitInThemeSet()}function fixBullshitInThemeSet(){let oldCodeSnippet="document.styleSheets[ i ].disabled = \ntrue;",newCodeSnippet=`if (document.styleSheets[i].title != "${webpackStylesheetName}") { document.styleSheets[i].disabled = true; }`,code=unsafeWindow.ThemeSet.toString().replace(oldCodeSnippet,newCodeSnippet);code="("+code+")",unsafeWindow.ThemeSet=eval(code)}},78:(e,t,n)=>{let o;n.d(t,{I:()=>h,R:()=>f});const i=document.createElement("div");let a,r,l,s;i.className="alei-param-side-buttons-container";const c=new ResizeObserver((()=>{s!==o.scrollHeight&&(s=o.scrollHeight,A())})),d=new MutationObserver((e=>{for(const t of e){for(const e of t.removedNodes)e.nodeType===Node.ELEMENT_NODE&&c.unobserve(e);for(const e of t.addedNodes)e.nodeType!==Node.ELEMENT_NODE||e.classList.contains("alei-param-side-buttons-container")||c.observe(e);s=o.scrollHeight,A()}}));let p,m,u,_={},g={};function h(e,t,n,o,i,r,l,s=null){const c=function(e,t,n,o){const i=document.createElement("button");return i.classList.add("alei-param-side-button",t),i.textContent=n,i.title=o,i.addEventListener("click",(()=>function(e){if(!a)return;const t={selectionData:p,elements:m,item:u};"trigger actions"==g[p._class][u].type&&(t.actionNum=I(m)),_[e].clickFunction(t),A()}(e))),i}(e,t,n,o);_[e]={element:c,clickFunction:i,allowMultipleSelection:l,visibilityCondition:s};for(const t in r){void 0===g[t]&&(g[t]={});for(const n in r[t]){const o=r[t][n].type;void 0===g[t][n]?g[t][n]={type:o,buttons:[e]}:g[t][n].buttons.push(e)}}}function f(){if(c.disconnect(),d.disconnect(),o=document.getElementById("rparams"),null!==o){for(const e of o.children)c.observe(e);d.observe(o,{childList:!0}),p=function(){let e=[],t=!1,n=null;for(const o of es)o.exists&&o.selected&&(e.push(o),null===n?n=o._class:n!=o._class&&(t=!0));return{objs:e,mixed:t,_class:t?null:n}}(),p.mixed||void 0===g[p._class]||(a=!1,o.addEventListener("mousemove",b),o.addEventListener("mouseleave",y),o.appendChild(i))}}function b(e){a=!0,r=e.clientX,l=e.clientY,A()}function y(){a=!1,x()}function A(){const{elements:e,item:t}=function(){if(a)for(const e in g[p._class]){let t;switch(g[p._class][e].type){case"param":t=w;break;case"elements":t=v;break;case"trigger actions":t=E}for(const n of t(e)){const t=n[0].getBoundingClientRect().top,o=n.reduce(((e,t)=>e+t.offsetHeight),0);if(t<=l&&l<=t+o)return{elements:n,item:e}}}return{elements:[],item:null}}();if(m=e,u=t,x(),null===t)return;const n=e[0].getBoundingClientRect().top,r=e.reduce(((e,t)=>e+t.offsetHeight),0),s=o.getBoundingClientRect();i.style.top=n-s.top+o.scrollTop,i.style.height=r,i.classList.add("alei-param-side-buttons-container--visible");let c=[];for(const e of g[p._class][t].buttons){const t=_[e].allowMultipleSelection;p.objs.length>1&&!t||S(e)&&c.push(e)}!function(e){for(const t of e){const e=_[t].element;i.appendChild(e)}}(c)}function*w(e){yield[o.querySelector("#pm_"+e).parentElement]}function*v(e){for(const t of o.querySelectorAll(e))yield[t]}function*E(e){let t=1,n=0;for(;n<o.children.length;){const e=o.children[n];"p_i"!=e.className||null===e.querySelector(`#pm_actions_${t}_type`)?n++:(yield[e,o.children[n+1],o.children[n+2]],n+=3,t+=1)}}function x(){for(const e of i.children)e.remove();i.classList.remove("alei-param-side-buttons-container--visible")}function S(e){const t=_[e].visibilityCondition;if(null===t)return!0;const n={selectionData:p,elements:m,item:u};return"trigger actions"==g[p._class][u].type&&(n.actionNum=I(m)),t(n)}function I(e){const t=e[0];if("p_i"!=t.className)return null;const n=t.children[1].id.match(/pm_actions_(\d+)_type/);return null===n?null:n[1]}},409:(e,t,n)=>{n.d(t,{l:()=>V});let o,i,a,r,l,s,c,d,p,m,u,_,g,h,f,b,y,A,w,v,E=unsafeWindow,x=[],S=[],I={},C=!1,O=!1,L=0,T=0,k=0,N=0,P="1";function D(e,t,n){let o=`ALEI_Renderer_${e}`;return void 0===localStorage[o]?t:n(localStorage[o])}let M,F,B={cartoonishEdges:D("CartoonishEdges",!1,(e=>"true"===e)),originalSelectOverlay:D("OriginalSelectOverlay",!1,(e=>"true"===e)),boxRendering:D("PreviewWalls",!1,(e=>"true"===e))},R={0:{backgroundColor:"#5880AB",gridColor:"#FFFFFF",selectOutlineColor:"#A5A500",selectEdgeOpacityFactor:1,selectTextColor:"#FF0",selectionColor:"#FFF",selectionCtrlColor:"#AFA",selectionAltColor:"#FAA",selectionOpacity:.1,selectionEdgeOpacity:.8,highLightedObjEdgeColor:E.selgrd3,highLightedObjEdgeOpacity:1,objectConnectionDash:[4,4],objectConnectionToColor:"#66ff66",objectConnectionFromColor:"#ffffff",objectConnectionOpacityFactor:1},1:{backgroundColor:"#222222",gridColor:"#888888",selectOutlineColor:"#FFFF00",selectEdgeOpacityFactor:1,selectTextColor:"#FF0",selectionColor:"#FFF",selectionCtrlColor:"#AFA",selectionAltColor:"#FAA",selectionOpacity:.1,selectionEdgeOpacity:.8,highLightedObjEdgeColor:E.selgrd3,highLightedObjEdgeOpacity:1,objectConnectionDash:[4,4],objectConnectionToColor:"#66ff66",objectConnectionFromColor:"#ffffff",objectConnectionOpacityFactor:1},2:{backgroundColor:"#222222",gridColor:"#FFFFFF",selectOutlineColor:"#FFFF00",selectEdgeOpacityFactor:1,selectTextColor:"#FF0",selectionColor:"#FFF",selectionCtrlColor:"#AFA",selectionAltColor:"#FAA",selectionOpacity:.1,selectionEdgeOpacity:.8,highLightedObjEdgeColor:E.selgrd3,highLightedObjEdgeOpacity:1,objectConnectionDash:[4,4],objectConnectionToColor:"#66ff66",objectConnectionFromColor:"#ffffff",objectConnectionOpacityFactor:1},3:{backgroundColor:"#222222",gridColor:"#FFFFFF",selectOutlineColor:"#FFFF00",selectEdgeOpacityFactor:1,selectTextColor:"#FF0",selectionColor:"#FFF",selectionCtrlColor:"#AFA",selectionAltColor:"#FAA",selectionOpacity:.1,selectionEdgeOpacity:.8,highLightedObjEdgeColor:E.selgrd3,highLightedObjEdgeOpacity:1,objectConnectionDash:[4,4],objectConnectionToColor:"#66ff66",objectConnectionFromColor:"#ffffff",objectConnectionOpacityFactor:1},4:{backgroundColor:"#222222",gridColor:"#FFFFFF",selectOutlineColor:"#FFFF00",selectEdgeOpacityFactor:1,selectTextColor:"#FF0",selectionColor:"#FFF",selectionCtrlColor:"#AFA",selectionAltColor:"#FAA",selectionOpacity:.1,selectionEdgeOpacity:.8,highLightedObjEdgeColor:E.selgrd3,highLightedObjEdgeOpacity:1,objectConnectionDash:[4,4],objectConnectionToColor:"#66ff66",objectConnectionFromColor:"#ffffff",objectConnectionOpacityFactor:1}},U={box:{col:"#FFF",edgeCol:"#FFF"},door:{col:"#000",edgeCol:"#000",invisibleOpacityFactor:.05},water:{col:"#3592B9",edgeCol:"#91EAFF",opacityFactor:.24,acidCol:"#BBFB59",acidEdgeCol:"#91EAFF",acidOpacityFactor:.81},pushf:{col:"#2BFF40",edgeCol:"#3CFF4F"},region:{col:"#FFD52B",edgeCol:"#FFB03C",edgeOpacityFactor:.5,buttonOpacityFactor:.5},bg:{col:"#000",edgeCol:"#910000",edgeOpacityFactor:.3,coloredOpacityFactor:.22}},j={};function G(e,t,n,a,r,s,c){l.globalAlpha=t,c?(B.cartoonishEdges?l.strokeColor=e:l.strokeStyle=e,i(n,a,r,s)):(l.fillStyle=e,o(n,a,r,s))}function z(e,t){if(!E.m_drag_selection)return;if(E.lmd)return;if(!E.MatchLayer(e))return;let n=g(Math.min(p,u)),o=h(Math.min(m,_)),i=A(Math.abs(u-p)),a=y(Math.abs(_-m)),r=t.x,l=t.y,s=t.w,c=t.h;return!(r+s<n||n+i<r||l+c<o||o+a<l)}function H(e){let t,n,o,i,a=e.pm;if(e._isresizable)t=g(a.x),n=h(a.y),o=A(a.w),i=y(a.h);else{let r=E.ThinkOfBBoxClass(e._class,e);n=h(a.y+E.bo_y[r]),i=y(E.bo_h[r]),-1!=a.side?(t=g(a.x+E.bo_x[r]),o=A(E.bo_w[r])):(t=g(a.x-E.bo_x[r]),o=A(-E.bo_w[r]),t+=o,o=-o)}return{x:t,y:n,w:o,h:i}}function q(e,t){if(!E.SHOW_CONNECTIONS)return;if(!e.exists)return;if(!e.selected)return;if(!C)return;let n=E.MatchLayer(e)?1:.3,o=E.ObjectConnectionMapping,i=E.uidToElementMap,a=e.pm.uid;if(null==a)return;if(0==o.length)return;if(null==o[a])return;if(0==o[a].by.length&&0==o[a].to.length)return;let r,s,c,d,p=o[a].by,m=o[a].to;r=t.x+t.w/2,c=t.y+t.h/2,l.globalAlpha=n*M.objectConnectionOpacityFactor,l.lineWidth=1,l.strokeStyle=M.objectConnectionToColor,l.setLineDash(M.objectConnectionDash);for(let e of m){if(!i[e].exists)continue;let t=H(i[e]);s=t.x+t.w/2,d=t.y+t.h/2,l.beginPath(),l.moveTo(r,c),l.lineTo(s,d),l.stroke()}l.strokeStyle=M.objectConnectionFromColor,s=r,d=c;for(let e of p){if(!i[e].exists)continue;let t=H(i[e]);r=t.x+t.w/2,c=t.y+t.h/2,l.beginPath(),l.moveTo(r,c),l.lineTo(s,d),l.stroke()}l.setLineDash([])}function W(e,t){e._isresizable?function(e,t){let n=e._class,o=U[n];if(void 0===o)return;let i=E.MatchLayer(e)?1:.3,a=e.pm,d=g(a.x),p=h(a.y),m=A(a.w),u=y(a.h),_=o.col,x=o.edgeCol,C=o.opacityFactor?o.opacityFactor:.2,O=o.edgeOpacityFactor?o.edgeOpacityFactor:1;if("bg"==n&&null==E.CACHED_BGS[a.m]&&-1==S.indexOf(a.m)&&(E.ServerRequest(`a=get_images&for_class=bg_model&update_const=${a.m}`,"request_consts"),S.push(a.m)),"door"!=n||0!==a.vis&&!1!==a.vis&&"false"!==a.vis)if("water"==n&&e.pm.damage>0)_=o.acidCol,x=o.acidEdgeCol,C=o.acidOpacityFactor;else if("region"==n&&-1!==[1,9,10].indexOf(parseInt(a.use_on))){l.globalAlpha=i*o.buttonOpacityFactor;let e=j[a.use_on];r(e,g(a.x+Math.round((a.w-41)/2)),h(a.y+Math.round((a.h-51)/2)),A(41),y(31))}else"bg"==n&&7==a.c.length&&(_=a.c,C=o.coloredOpacityFactor);else C=o.invisibleOpacityFactor;if(E.SHOW_TEXTURES)if("box"!=n||B.boxRendering){if("box"==n&&B.boxRendering){let e=I[a.m];null==e&&(e=new Image,I[a.m]=e,e.src=`pic.php?c=3&m=${a.m}`,e.width=16,e.height=16),null==e.pattern&&(e.pattern=l.createPattern(e,"repeat-x")),l.globalAlpha=1,l.save(),l.beginPath(),l.rect(d,p,m,u),l.closePath(),l.clip(),l.translate(g(0),h(0)),l.scale(g(1)-g(0),h(1)-h(0)),l.beginPath(),l.fillStyle=e.pattern,l.rect(f(0),b(0),v(c),w(s)),l.fill(),l.restore()}else if("bg"==n&&void 0!==E.CACHED_BGS[a.m]&&E.CACHED_BGS[a.m].loaded){-1!==S.indexOf(a.m)&&S.splice(S.indexOf(a.m),1),l.globalAlpha=1;let e=E.CACHED_BGS[a.m];if(null==e.pattern&&(e.pattern=l.createPattern(e,"repeat")),l.save(),l.beginPath(),l.rect(d,p,m,u),l.closePath(),l.clip(),l.translate(g(0),h(0)),l.scale(g(1)-g(0),h(1)-h(0)),l.translate(a.u,a.v),l.beginPath(),l.fillStyle=e.pattern,l.rect(f(0),b(0),v(c),w(s)),l.fill(),l.restore(),7==a.c.length){let e=l.globalCompositeOperation;l.globalCompositeOperation="multiply",G(a.c,1,d,p,m,u,!1),l.globalCompositeOperation=e}}}else _="#000",C=1,x="#333";z(e,t)&&(x=M.highLightedObjEdgeColor,O=M.highLightedObjEdgeOpacity/i),e.selected&&!B.originalSelectOverlay&&(x=M.selectOutlineColor,O=M.selectEdgeOpacityFactor),E.SHOW_TEXTURES&&("bg"==n||"box"==n&&B.boxRendering)||G(_,i*C,d,p,m,u,!1),E.SHOW_TEXTURES||G(x,i*O,d,p,m,u,!0)}(e,t):function(e,t){let n=e._class,o=E.MatchLayer(e)?1:.3,i=e.pm,a=i.x,s=i.y,c="#000",d=.1;z(e,t)&&(c=M.highLightedObjEdgeColor,d=M.highLightedObjEdgeOpacity/o),e.selected&&!B.originalSelectOverlay&&(c=M.selectOutlineColor,d=M.selectEdgeOpacityFactor),function(e,t,n){let o,i,a=e.pm,r=a.x,l=a.y,s=E.ThinkOfBBoxClass(e._class,e),c=E.bo_x[s],d=E.bo_y[s],p=E.bo_w[s],m=E.bo_h[s],u=h(l+d),_=y(m);-1!=a.side?(o=g(r+c),i=A(p)):(o=g(r-c),i=A(-p),o+=i,i=-i),G(t,n,o,u,i,_,!0)}(e,c,o*d),l.globalAlpha=o;let p=!1;if("decor"==n){let e=i.model;null==E.special_values_table.decor_model[e]&&-1==x.indexOf(e)&&(E.ServerRequest(`a=get_images&for_class=decor_model&update_const=${e}`,"request_consts"),x.push(e)),0==i.r&&1==i.sx&&1==i.sy||(l.save(),l.translate(g(a),h(s)),l.rotate(i.r/180*Math.PI),l.scale(i.sx,i.sy),l.translate(-g(a),-h(s)),p=!0)}let m=E.ThinkOfOffsetClass(n,e),u=-1!=i.side?1:-1,_=g(a+u*E.lo_x[m]),f=h(s+E.lo_y[m]),b=A(u*E.lo_w[m]),w=y(E.lo_h[m]);if(-1==u&&(l.save(),l.translate(2*_+b,0),l.scale(-1,1)),-1!==["player","enemy"].indexOf(n))r(E.img_chars_full[i.char],g(i.x-36),h(i.y-104),A(110),y(130));else if("decor"!=n||void 0===E.CACHED_DECORS[i.model]||E.CACHED_DECORS[i.model].native)r(E.img_decide(e),_,f,b,w);else{-1!==x.indexOf(i.model)&&x.splice(x.indexOf(i.model),1);let e=E.CACHED_DECORS[i.model];r(e,g(i.x+i.u),h(i.y+i.v),A(e.width),y(e.height))}-1==u&&l.restore(),p&&l.restore()}(e,t),function(e,t){e.selected&&B.originalSelectOverlay&&(l.globalAlpha=.2,l.fillStyle=E.selgrd2,o(t.x,t.y,t.w,t.h),l.globalAlpha=1,l.fillStyle="#FFF",E.MyDrawSelection(t.x-2,t.y-2,t.w+4,t.h+4))}(e,t),function(e,t){if(!E.quick_pick||-1==E.lqpc.indexOf(e._class))return;if(!E.MatchLayer(e))return;let n=t.x,o=t.y,i=n+t.w/2,a=o+t.h/2,s=Math.sin((new Date).getTime()/100);l.globalAlpha=.75-s/4;let c=27+5*s,d=!1;(E.es[E.quick_pick_fake_over]==e||E.Dist2D(i,a,E.mouse_x,E.mouse_y)<20*E.quick_pick_hit_scale)&&(d=!0),r(d?E.img_quickpick2:E.img_quickpick,i-c,a-c,2*c,2*c)}(e,t),function(e,t){if(!E.ENABLE_TEXT)return;if(null==e.pm.uid)return;if(!E.MatchLayer(e))return;null==E.last_title_density&&(E.last_title_density=0);let n=t.x+t.w/2,o=t.y+t.h/2,i=e.selected&&e.hit(!1);l.font="normal 10px Arial";let a=e.pm.uid,r=l.measureText(a);if(r.height=10,i&&(r.height=12),E.mouse_x>n-30&&E.mouse_x<n+30&&E.mouse_y>o-30&&E.mouse_y<o+30&&title_density++,l.globalAlpha=1,E.last_title_density>1&&!i){let t=Math.sqrt(Math.pow(E.mouse_x-n,2)+Math.pow(E.mouse_y-o,2));t<60&&(e.selected?l.globalAlpha=Math.max(.3,1/E.last_title_density):(n-=(E.mouse_x-n)*Math.pow((60-t)/60,2)*(4+Math.min(6,.1*E.last_title_density)),o-=(E.mouse_y-o)*Math.pow((60-t)/60,2)*(4+Math.min(6,.1*E.last_title_density)),E.last_title_density>1&&(l.globalAlpha=Math.max(.4,1-.1*E.last_title_density))))}let s=Math.round(n-r.width/2),c=Math.round(o-r.height/2);E.ENABLE_SHADOWS&&(l.fillStyle="rgba(0,0,0,0.1)",l.fillRect(s-2,c-2,r.width+4,r.height+4),l.fillRect(s-4,c-4,r.width+8,r.height+8)),l.fillStyle="#FFF",i&&(l.fillStyle="#fffb91"),e.selected&&(l.fillStyle=M.selectTextColor),l.fillText(a,s,c+8+(r.height-10)/2),E.last_title_density=E.title_density}(e,t),q(e,t),function(e,t){if(!e.selected)return;if(!e._isresizable)return;if(!E.MatchLayer(e))return;t.x,t.y,t.w,t.h;let n=e.pm.x,o=e.pm.y,i=e.pm.w,a=e.pm.h,r=u,l=_,s=E.borderwidth;if(r<n-s)return;if(n+i+s<r)return;if(l<o-s)return;if(o+a+s<l)return;let c,d,p,m=!1;n-s<=r&&r<=n+s&&(p=!0),n+i-s<=r&&r<=n+i+s&&(m=!0),o-s<=l&&l<=o+s&&(c=!0),o+a-s<=l&&l<=o+a+s&&(d=!0);let g="default";c&&p||d&&m?g="nwse-resize":c&&m||d&&p?g="nesw-resize":c||d?g="ns-resize":(p||m)&&(g="ew-resize"),E.canv.style.cursor!=g&&(E.canv.style.cursor=g)}(e,t)}function X(e){return Math.round(e/E.GRID_SNAPPING)*E.GRID_SNAPPING}function $(){return(new Date).getTime()}function Y(){if(E.requestAnimationFrame(Y),function(){let e=E.k_shift?5:1,t=!1;if(0!==E.speed_x){let n=10*E.zoom*e*E.speed_x;E.dis_from_x+=n,E.dis_to_x+=n,t=!0}if(0!==E.speed_y){let n=10*E.zoom*e*E.speed_y;E.dis_from_y+=n,E.dis_to_y+=n,t=!0}t&&(E.zoom_validate(),E.need_redraw=!0,E.lmd=!1,E.lmwa=f(E.mouse_x),E.lmwb=f(E.mouse_y))}(),E.need_redraw&&(c=E.lsu,s=E.lsv,M=R[E.THEME],d=E.GRID_ALPHA,p=E.lmdrwa,m=E.lmdrwb,u=E.lmwa,_=E.lmwb,E.canv.style.cursor="default",l.globalAlpha=1,E.SHOW_TEXTURES?r(E.CACHED_SKY[P],0,0,c,s):(l.fillStyle=M.backgroundColor,o(0,0,c,s)),d<=0||(l.fillStyle=M.gridColor,a(10,.08*d),a(100,.32*d),a(300,.64*d),l.globalAlpha=.7*d,o(0,h(0),c,1),o(g(0),0,1,s)),function(){k=0;let e=E.left_panel.getBoundingClientRect(),t=E.right_panel.getBoundingClientRect(),n=E.top_panel.getBoundingClientRect(),o=Math.round(f(e.width+e.x)),i=Math.round(b(n.height+n.y)),a=Math.round(v(t.x-(e.width+e.x))),r=Math.round(w(s-(n.height+n.y)));for(let e of E.es){let t,n=e.pm,l=n.x,s=n.y,c=n.w?n.w:0,d=n.h?n.h:0;e.exists&&e._isphysical&&(e.selected&&(t=H(e),q(e,t)),l+c<o||s+d<i||o+a<l||i+r<s||(null==t&&(t=H(e)),W(e,t),k++))}}(),function(){if(!E.m_drag_selection)return;if(E.lmd)return;let e=g(p),t=h(m),n=A(u-p),o=y(_-m),i=M.selectionColor;E.ctrl?i=M.selectionCtrlColor:E.alt&&(i=M.selectionAltColor),G(i,M.selectionOpacity,e,t,n,o),G(i,M.selectionEdgeOpacity,e,t,n,o,!0)}(),"edit"!=E.active_tool&&(l.globalAlpha=1,r(E.img_put,g(X(u))-15,h(X(_))-15,31,31))),E.need_GUIParams_update&&(E.need_GUIParams_update=!1,E.UpdateGUIParams(),E.UpdateGUIObjectsList()),T++,$()-N>=1e3&&(N=$(),L=T,T=0),function(){let e,t,n=document.getElementById("gui-render-info");null!==n?(e=n.children[0],t=n.children[1]):(n=document.createElement("div"),n.id="gui-render-info",e=document.createElement("p"),e.className="gui-render-info__text",t=document.createElement("p"),t.className="gui-render-info__text",F&&(e.style.padding=0,e.style.margin=0,t.style.padding=0,t.style.margin=0),n.appendChild(e),n.appendChild(t),E.right_panel.childNodes[0].insertBefore(n,document.getElementById("gui_params"))),e.textContent=`Renderer FPS: ${L}`,t.textContent=`Rendered Object: ${k} / ${E.es.length}`}(),C&&!O){if(null==document.getElementById("rparams"))return;E.ShowHideObjectBox(),E.ShowHideObjectBox(),O=!0}}function K(){if(!E.ALEI_Active)return;C=!0;let e=E.ALEIAPI;if(null==e)return void setTimeout(K,1e3);let t=e.settings;t.addText("[R] Cartoonish Edges:",!1),t.createButtons("ALEI_Renderer_CartoonishEdges",B,"cartoonishEdges",[["Yes",!0],["No",!1]]),t.addText("[R] Original Select:",!1),t.createButtons("ALEI_Renderer_OriginalSelectOverlay",B,"originalSelectOverlay",[["Yes",!0],["No",!1]]),t.addText("[R] Preview walls:",!1),t.createButtons("ALEI_Renderer_PreviewWalls",B,"boxRendering",[["Yes",!0],["No",!1]]),E.ALEI_settingUpdateButtons()}function V(){l=E.ctx,i=(e,t,n,o)=>l.strokeRect(e,t,n,o),o=E.lmfr,a=E.lg,r=(e,t,n,o,i)=>E.MyDrawImage(e,t,n,o,i),j={1:E.img_region,9:E.img_region_red,10:E.img_region_blue},g=E.w2s_x,h=E.w2s_y,f=E.s2w_x,b=E.s2w_y,y=E.w2s_h,A=E.w2s_w,w=E.s2w_h,v=E.s2w_w;let e=E.ShowTexturesSet;E.ShowTexturesSet=t=>{!function(e){if(e)for(let e of E.es){if("inf"!=e._class)continue;let t=e.pm;if("sky"==t.mark)return void(P=t.forteam)}}(t),e(t)},E.Render=()=>{},E.ani=()=>{},E.requestAnimationFrame(Y),N=$(),K(),C||E.NewNote("ALEI Renderer: You are not running with ALEI. Don't expect feature completeness as renderer depends on ALEI giving some informations.","#FFFF00"),console.log("[ALEI Renderer]: Active.")}try{GM_info,F=-1==["ALE Improvements","ALE Improvements Local"].indexOf(GM_info.script.name)}catch(e){F=!0}F&&document.addEventListener("DOMContentLoaded",(()=>V()))}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={id:e,exports:{}};return __webpack_modules__[e](n,n.exports,__webpack_require__),n.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={},_loadcss_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(342),_alescript_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(338),_renderer_user_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(409),_aleimapdata_aleimapdata_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(186),_aleimapdata_aleimapdatapatches_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(606),_comments_commentdata_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(209),_comments_commenttextarea_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(523),_paramsidebuttons_paramsidebuttons_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(78),_comments_commentbuttons_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(964);let main_window=unsafeWindow,isNative;try{GM_info,isNative=!0,main_window.nativeALEIRunning=!0}catch(e){isNative=!1}function $id(e){return document.getElementById(e)}function $query(e){return document.querySelector(e)}isNative||1!=main_window.nativeALEIRunning||Hello_IgnoreThisError_ItIsIntentional,main_window.ALEI_Active=!0;let ROOT_ELEMENT=document.documentElement,stylesheets=document.styleSheets,VAL_TABLE={},displayOperationCompleteNotes=!0,REGION_EXECUTE_PARAM_ID,OCM_LOADED=!0,ExtendedTriggersLoaded=!1;const INFO=0,DEBUG=1,DEBUG2=2,VERBOSE=null,WARN=-1,SWARN=-2,__OCM_CHECKED_KEYS=["target","attach","use_target","incar","ondeath","callback"],ANSI_RESET="[0m",ANSI_RED="[31m",ANSI_GREY="[37m",ANSI_YELLOW="[93m",ANSI_GREEN="[92m",ANSI_CYAN="[96m";function readStorage(e,t,n){return void 0===localStorage[e]?t:n(localStorage[e])}null!=localStorage.RIGHT_PANEL_WIDTH&&(localStorage.ALEI_RightPanelWidth=localStorage.RIGHT_PANEL_WIDTH,localStorage.removeItem("RIGHT_PANEL_WIDTH"));let aleiSettings={rightPanelSize:readStorage("ALEI_RightPanelWidth","30vw",(e=>e)),triggerEditTextSize:readStorage("ALEI_EditTextSize","12px",(e=>e+"px")),starsImage:readStorage("ALEI_StarImage","stars2.jpg",(e=>e)),logLevel:readStorage("ALEI_LogLevel",0,parseInt),showTriggerIDs:readStorage("ALEI_ShowTriggerIDs",!1,(e=>"true"===e)),enableTooltips:readStorage("ALEI_ShowTooltips",!1,(e=>"true"===e)),showSameParameters:readStorage("ALEI_ShowSameParameters",!0,(e=>"true"===e)),rematchUID:readStorage("ALEI_RemapUID",!1,(e=>"true"===e)),blackTheme:readStorage("ALEI_BlackTheme",!1,(e=>"true"===e)),gridBasedOnSnapping:readStorage("ALEI_gridBasedOnSnapping",!0,(e=>"true"===e)),renderObjectNames:readStorage("ALEI_RenderObjectNames",!0,(e=>"true"===e)),ocmEnabled:!0,extendedTriggers:readStorage("ALEI_ExtendedTriggersEnabled",!0,(e=>"true"===e)),customRenderer:readStorage("ALEI_Renderer_Enabled",!0,(e=>"true"===e)),orderedNaming:readStorage("ALEI_orderedNaming",!0,(e=>"true"===e))};function writeStorage(e,t){try{localStorage[e]=t}catch(e){NewNote("ALEI: There was some issue trying to save into storage. You might need to clear your datas.",note_bad),console.error(e)}}main_window.aleiSettings=aleiSettings;let levelToNameMap={0:`${ANSI_CYAN}INFO${ANSI_RESET}`,1:`${ANSI_GREEN}DEBUG${ANSI_RESET}`,2:`${ANSI_GREEN}VERBOSE${ANSI_RESET}`};function aleiLog(e,t){e<=WARN?(console.warn(`[ALEI:WARNING]: ${t}`),e===WARN&&NewNote("ALEI: Please check console.","#FFFF00")):e<=aleiSettings.logLevel&&console.log(`[${ANSI_GREEN}ALEI:${levelToNameMap[e]}]: ${t}`)}aleiLog(INFO,"Starting up...");let JS_setTimeout=main_window.setTimeout,JS_eval=main_window.eval,ALE_Render,aleiSessionID=null,aleiSessionList=[];function updateParameters(){function e(e,t,n,o){param_type[param_type.length]=[e,t,n,"",o]}e("moving","bool","Is Moving?","door"),e("tarx","value","Target X","door"),e("tary","value","Target Y","door"),e("__id","value","Object ID","*"),e("__priority","value","Object priority","*"),e("execute","bool","Executes directly?","trigger"),e("uses_timer","bool","Calls timer?","region"),e("text","string","Placeholder text","decor"),e("attach","door+none","Attach to","water"),param_type[0]=["uid","string","Name","Object Name","*"];for(let e=0;e<param_type.length;e++){let t=param_type[e],n=t[0],o=t[4];"use_target"!=n||"region"!=o?-1==["w","h"].indexOf(n)||(param_type[e][1]="value+round10"):REGION_EXECUTE_PARAM_ID=e}VAL_TABLE["timer+none"]=new Array,VAL_TABLE["timer+none"][-1]="- No timer -",VAL_TABLE["timer+none"]["[listof]"]="timer"}function updateSounds(){let e=VAL_TABLE.sound;e.am_base="Indoor Ambience",e.am_wind="Outdoor Ambience",e.android2_die="DT-148 - Death",e.android2_hurt="DT-148 - Hurt",e.android2_welcome2="DT-148 - Alerted",e.arrin_death1="Arrin - Death",e.arrin_dying="Arrin - Dying",e.arrin_hurt1="Arrin - Hurt 1",e.arrin_hurt2="Arrin - Hurt 2",e.arrin_welcome1="Arrin - Alerted 1",e.arrin_welcome2="Arrin - Alerted 2",e.arrin_welcome3="Arrin - Alerted 3",e.bounce_bullet="Falkonian PSI Cutter - Shot Bounce",e.dart4="Medic Pistol",e.exp_event_stop="EXP - Stop",e.exp_level="EXP - Level Up",e.exp_tick="EXP - Gain",e.gameplay_song="Katharsys - Erges",e.gravitator2="Floor gravitator noice",e.helm_proxy_alert_over_hereB="Proxy - Over here!",e.helm_proxy_alert_take_coverB="Proxy - Take cover!",e.helm_proxy_alert_up_thereA="Proxy - Up there!",e.helm_proxy_death3="Proxy - Death 1",e.helm_proxy_death4="Proxy - Death 2",e.helm_proxy_death5="Proxy - Death 3",e.helm_proxy_death6="Proxy - Death 4",e.helm_proxy_dyingC="Proxy - Help! 1",e.helm_proxy_dyingF="Proxy - Help! 2",e.helm_proxy_enemy_down_fantasticA="Proxy - Fantastic.",e.helm_proxy_enemy_down_got_oneD="Proxy - Got one.",e.helm_proxy_enemy_down_niceA="Proxy - Nice. 1",e.helm_proxy_enemy_down_niceC="Proxy - Nice. 2",e.helm_proxy_hurt11="Proxy - Hurt 1",e.helm_proxy_hurt12="Proxy - Hurt 2",e.helm_proxy_hurt13="Proxy - Hurt 3",e.helm_proxy_hurt14="Proxy - Hurt 4",e.helm_proxy_hurt15="Proxy - Hurt 5",e.helm_proxy_hurt17="Proxy - Hurt 6",e.helm_proxy_hurt4="Proxy - Hurt 7",e.helm_proxy_hurt5="Proxy - Hurt 8",e.helm_proxy_hurt8="Proxy - Hurt 9",e.helm_proxy_hurt9="Proxy - Hurt 10",e.hexagon_death1="Hexagon - Death 1",e.hexagon_death2="Hexagon - Death 2",e.hexagon_pain1="Hexagon - Hurt 1",e.hexagon_pain2="Hexagon - Hurt 2",e.hexagon_pain3="Hexagon - Hurt 3",e.hexagon_pain4="Hexagon - Hurt 4",e.hexagon_welcome1="Hexagon - Alerted 1",e.hexagon_welcome2="Hexagon - Alerted 2",e.hexagon_welcome3="Hexagon - Alerted 3",e.main_song="NPhonix - Antigravity",e.orakin_death1="Orakin - Death 1",e.orakin_death2="Orakin - Death 2",e.orakin_hurt="Orakin - Hurt",e.orakin_welcome="Orakin - Alerted",e.proxy_alert_over_hereB="No Helm Proxy - Over here!",e.proxy_alert_take_coverB="No Helm Proxy - Take cover!",e.proxy_alert_up_thereA="No Helm Proxy - Up there!",e.proxy_death3="No Helm Proxy - Death 1",e.proxy_death4="No Helm Proxy - Death 2",e.proxy_death5="No Helm Proxy - Death 3",e.proxy_death6="No Helm Proxy - Death 4",e.proxy_dyingC="No Helm Proxy - Help! 1",e.proxy_dyingF="No Helm Proxy - Help! 2 ",e.proxy_enemy_down_fantasticA="No Helm Proxy - Fantastic.",e.proxy_enemy_down_got_oneD="No Helm Proxy - Got one.",e.proxy_enemy_down_niceA="No Helm Proxy - Nice. 1",e.proxy_enemy_down_niceC="No Helm Proxy - Nice. 2",e.proxy_hurt11="No Helm Proxy - Hurt 1",e.proxy_hurt12="No Helm Proxy - Hurt 2",e.proxy_hurt13="No Helm Proxy - Hurt 3",e.proxy_hurt14="No Helm Proxy - Hurt 4",e.proxy_hurt15="No Helm Proxy - Hurt 5",e.proxy_hurt17="No Helm Proxy - Hurt 6",e.proxy_hurt4="No Helm Proxy - Hurt 7",e.proxy_hurt5="No Helm Proxy - Hurt 8",e.proxy_hurt8="No Helm Proxy - Hurt 9",e.proxy_hurt9="No Helm Proxy - Hurt 10",e.silk_alert_contactA="Silk - Contact!",e.silk_alert_i_see_oneA="Silk - I see one.",e.silk_alert_there_is_oneA="Silk - There is one...!",e.silk_death1B="Silk - Death 1",e.silk_death2B="Silk - Death 2",e.silk_dyingB="Silk - Not good...",e.silk_enemy_down_brilliantC="Silk - Brilliant.",e.silk_enemy_down_eliminatedB="Silk - Eliminated.",e.silk_enemy_down_hell_yeahB="Silk - Hell yeah!",e.silk_enemy_down_ive_got_oneB="Silk - I got one!",e.silk_enemy_down_minus_oneB="Silk - -1.",e.silk_enemy_down_no_kicking_for_youB="Silk - No kicking for you.",e.silk_hurt1B="Silk - Hurt 1",e.silk_hurt2B="Silk - Hurt 2",e.silk_hurt5="Silk - Hurt 3",e.silk_hurt6="Silk - Hurt 4",e.silk_hurt9B="Silk - Hurt 5",e.wea_crossfire2="Crossfire CR-145 Vortex",e.wea_ditzy_cs_ik="Assault Rifle CS-IK",e.wea_glhf="Grenade Launcher CS-GLHF",e.wea_incompetence_archetype_27xx_fire="Archetype 27XX",e.wea_lazyrain_gravy_rl="Falkonian Anti-Grav Rocket Launcher",e.wea_m202="Rocket Launcher CS-Barrage",e.wea_moonhawk_railgun="Crossfire CR-34 Marauder",e.wea_ph01="Crossfire CR-54 Viper",e.wea_plasma_shotgun="Plasma Shotgun",e.wea_rail_alt2="Falkonian PSI Cutter",e.wea_thetoppestkek_shotgun_nxs25="Shotgun NXS-25",e.xin_celebrate="Xin - Celebrating",e.xin_death="Xin - Death",e.xin_enemy_spotted="Xin - Alerted",e.xin_hit="Xin - Hurt";let t={Grosk:["Grosk",["death","Death",2],["dying","Dying",2],["edown","Celebrating",3],["welcome","Alerted",5],["hurt","Hurt",3]],drohnentroop:["Drohnen Trooper",["welcome","Alerted",3],["hurt","Hurt",3],["edown","Celebrating",3],["dying","Dying",1],["death","Death",3]],drohnenfem:["Drohnen Female",["welcome","Alerted",3],["hurt","Hurt",3],["edown","Celebrating",3],["dying","Dying",1],["death","Death",3]],elurra:["Elurra",["welcome","Alerted",3],["hurt","Hurt",2],["edown","Celebrating",2],["dying","Dying",1],["death","Death",1]],ferro:["Lt. Ferro",["welcome","Alerted",3],["hurt","Hurt",2],["edown","Celebrating",3],["death","Death",2]],serkova:["Serkova",["welcome","Alerted",3],["hurt","Hurt",1],["edown","Celebrating",2],["death","Death",1]],phantom:["Phantom",["edown","Celebrating",1],["welcome","Alerted",2],["death","Death",1]]};for(let n of Object.entries(t)){let t=n[0],o=n[1],i=o[0];for(let n=1;n<o.length;n++){let a=o[n];for(let n=1;n<=a[2];n++)e[`${t}_${a[0]}${n}`]=`${i} - ${a[1]} ${n}`}}}function updateVoicePresets(){let e=VAL_TABLE.voice_preset;e.proxy_helmetless="Proxy (helmetless)",e.silk="Silk",e.orakin="Orakin",e.arrin="Arrin",e.civilian_male="Civilian Male",e.vulture="Vulture",e.crossfire_sentinel="Crossfire Sentinel",e.xin="Xin",e.grosk="Grosk",e.elurra="Elurra",e.drohnenfem="Drohnen Female",e.serkova="Serkova",e.ferro="Lt. Ferro",e.drohnentroop="Drohnen Trooper",e.phantom="Phantom"}function updateStyles(){for(let e=0;e<stylesheets.length;e++){let t=stylesheets[e];for(let e=0;e<t.rules.length;e++){let n=t.rules[e];switch(n.selectorText){case".p_i":n.style.setProperty("display","flex");break;case".rightui":n.style.setProperty("width",aleiSettings.rightPanelSize);break;case".pa1":n.style.setProperty("flex-grow",0),n.style.setProperty("flex-shrink",0);break;case".pa2":n.style.setProperty("width","100%");break;case".opcode_field":n.style.setProperty("font-size",aleiSettings.triggerEditTextSize);break;case"#rparams":n.style.setProperty("height","var(--ALEI_RPARAMS_HEIGHT)")}}}$id("stars").style.setProperty("background-image",`url(${aleiSettings.starsImage})`);let e=THEME;ThemeSet(THEME_BLUE),ThemeSet(e)}function updateSkins(){let e=[[10,"Head Gib"],[18,"Star Defender (play map ID 'eric gurt-star_defenders' to unlock it)"],[20,"Arm Gib"],[30,"Leg Gib"],[50,"Heavy Hero (Only Head and Arms)"],[60,"Proxy (Only Head and Arms)"],[62,"Proxy (No Limbs)"],[38,"GoldenKnife Noir Lime"],[39,"RootZ Noir Lime"],[151,"Purple Xin"],[152,"Golden Xin"],[153,"Blue Xin"],[154,"Red Xin"],[155,"Amber Xin"],[156,"Nirvana Noir Lime"],[157,"Purple Gallynew"],[158,"Golden Gallynew"],[159,"Blue Gallynew"],[160,"Red Gallynew"],[161,"Amber Gallynew"],[162,"Pinkine"],[163,"Raider (by Serpent)"],[164,"Blue Heavy Hero"],[165,"Red Heavy Hero"],[166,"Orakin"],[167,"Husk"],[168,"Hex"],[169,"Arrin"],[170,"Heavy Usurpation Soldier"],[171,"Cyber Grub by S1lk"],[172,"Grosk"],[173,"Futuristic Knight"],[174,"Uncivil Proxy"],[175,"Serkova Insertion Unit"],[176,"Xenos Scout"],[177,"Armored Trooper"],[178,"New Generation Marine"],[179,"Elurra (by Lin)"],[180,"Dark Proxy (by littlekk)"],[181,"Huntsman (Night)"],[182,"Huntsman (Swamp)"],[183,"Lt. Ferro (by Serpent)"],[184,"Xenos Titan"],[185,"Elurra (Masked) (by Lin)"],[186,"Drohnen Heavy (by Ark633)"],[187,"Cromastakan"],[188,"Sgt. Davais"],[189,"Maroon (by Francis localhost)"],[190,"Drohnen Skirmisher (by Ark633)"],[191,"Serkova Recon Unit"],[192,"Drohnen Drifter (by Ark633)"],[193,"Xenos Marine"],[194,"Dark Android SLC-56 (by littlekk)"],[195,"Wraith (by Ark633)"],[196,"Serkova Armored Unit"],[197,"Phantom (play map ID 'therealon3-phantom' to unlock it)"],[198,"Blue Civil Security Heavy"],[199,"Red Civil Security Heavy"],[200,"Xenos Welder"],[201,"Xenos Special Unit"],[202,"Serkova Assault Unit"],[203,"Serkova Gunner Unit"],[204,"Serkova Grenader Unit"],[205,"Serkova Team Leader"],[206,"Serkova Resource Unit"],[207,"Serkova Technician Unit"],[208,"Serkova Grub"],[209,"Serkova Reinforced Grub"],[210,"Serkova Devastator Grub"],[211,"XBT-117 Android"],[212,"Teneguilae"],[213,"Walker (by Serpent)"],[214,"Space Grub (by Broforce1)"],[215,"Blue Phantom (play map ID 'therealon3-phantom' to unlock it)"],[216,"Red Phantom (play map ID 'therealon3-phantom' to unlock it)"]];for(let t=0;t<e.length;t++){let n=e[t][0],o=n.toString().padStart(4,"0"),i=e[t][1],a="https://www.plazmaburst2.com/level_editor/chars_full/char"+o+".png";VAL_TABLE.char[n]=_turnLinkIntoSkinSpan(a,i),img_chars_full[n]=new Image,img_chars_full[n].src="chars_full/char"+o+".png"}let t=Object.keys(VAL_TABLE.char);t=t.map((e=>parseInt(e))),fetchSkinsFrom(Math.max(...t)+1)}function _turnLinkIntoSkinSpan(e,t){return"<span style='background:url("+e+"); width: 16px; height: 16px; display: inline-block; background-position: center; background-position-x: 30%; background-position-y: 26%; background-size: 67px;vertical-align: -4px;'></span> "+t}async function fetchSkinsFrom(e){if(!isNative)return;let t=!0,n=[];async function o(e){let o="https://www.plazmaburst2.com/level_editor/chars_full/char"+e.toString().padStart(4,"0")+".png";404!=(await GM.xmlHttpRequest({url:o}).catch((e=>console.error(e)))).status?(VAL_TABLE.char[e]=_turnLinkIntoSkinSpan(o,`Unknown Skin #${e}`),n.push(e)):t=!1}async function i(e){let t=[];for(let n=0;n<5;n++)t.push(o(e+n));await Promise.all(t)}let a=e;for(;t;)await i(a),a+=5;n.length>0&&(NewNote(`ALEI: There are ${n.length} unregistered skins, please inform ALEI developer(s) about this. Check logs for more information`,"#00FFFF"),aleiLog(INFO,`Unregistered skins: ${n}`))}function optimize(){main_window.setTimeout=(e,t)=>{if(e!=ani)return JS_setTimeout(e,t);main_window.requestAnimationFrame(ani)};let e=main_window.BrowseImages,t={};main_window.BrowseImages=function(n="bg_model",o="",i=null){null==t[n]&&(t[n]="[ALEI] Loading...",aleiLog(INFO,`Will cache response of ${n}`));let a=main_window.setTimeout;main_window.setTimeout=(e,o)=>{main_window.setTimeout=a,main_window.ServerRequest=(e,o,i=null)=>{main_window.ServerRequest=ALEI_ServerRequest,ServerRequest(e,o,i).then((()=>{t[n]=image_list.innerHTML}))},e()},e(n,o,i),image_list.innerHTML=t[n]}}function updateVehicles(){let e=VAL_TABLE.vehicle_model,t=[["veh_hh","Grabbable Ledge","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAACLSURBVEhLYxhxgBFE2M3/r/vvH0MQWISGgImJYd2hRMbLIDbYYpu5/+t/MzEEf2diuALi0wJw/mPQYf3HsPZIMmMjiA+3+BMLg/olIYblID4tgN47hki+Pww3YRYzgUUHAIxaTDcwajHdwKjFdAOjFtMNjFpMNzBqMd3AqMV0AwPbrh6InsQAAQYGAA8CLDKAAcpOAAAAAElFTkSuQmCC"]];for(let n=0;n<t.length;n++){let o=t[n],i=o[0],a=o[1],r=o[2];e[i]=`<img src='${r}' border=0 height=12 style=vertical-align:middle title='${a}' > ${a}`,img_vehicles[i]=new Image,img_vehicles[i].src=r}}function updateGuns(){let e=[["gun_rl0","BETA Rocket Launcher","data:image/png;base64,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"]];for(let t=0;t<e.length;t++){let n=e[t],o=n[0],i=n[1],a=n[2];VAL_TABLE.gun_model[o]=`<img src='${a}' border=0 width=80 height=20 style=vertical-align:baseline title='${i}'>`,img_guns[o]=new Image,img_guns[o].src=a}}function updateDecors(){main_window.img_decors=CACHED_DECORS;let e=[["hakase","Hakase","data:image/png;base64,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"]];for(let t=0;t<e.length;t++){let n=e[t],o=n[0],i=n[1],a=n[2];VAL_TABLE.decor_model[o]=i,img_decors[o]=new Image,img_decors[o].src=a,img_decors[o].native=!0,CACHED_DECORS[o]=img_decors[o],CUSTOM_IMAGES_APPROVED[o]=!0}main_window.ALEI_decors=e}function updateOffsets(){let e=main_window.ThinkOfOffsetClass;main_window.ThinkOfOffsetClass=function(n,o){return"vehicle"==n&&null!=t[o.pm.model]||"decor"==n&&null!=t[o.pm.model]?"alei_"+o.pm.model:"gun"==n&&"gun_rl0"==o.pm.model?"alei_gun_rl0":e(n,o)};let t={veh_hh:{x:-15,y:-15,w:30,h:30},hakase:{x:-18,y:-57,w:40,h:60},gun_rl0:{x:-24,y:-6,w:61,h:13}};for(let e in t){let n=t[e];lo_x["alei_"+e]=n.x,lo_y["alei_"+e]=n.y,lo_w["alei_"+e]=n.w,lo_h["alei_"+e]=n.h}}function updateTriggers(){addTrigger(175,"Gun &#8250; Change gun 'A' projectile model to 'B'","gun","ALEI_projectileModels"),addTrigger(378,"Gun &#8250; Add hex color 'B' to gun 'A'","gun","string"),addTrigger(332,"Var &#8250; Set variable 'A' to value 1 if Gun 'B' is in owner's active slot, set to value 0 in else case","string","gun")}function updateObjects(){updateGuns(),updateVehicles(),updateDecors(),updateTriggers()}function updateButtons(){let e=$id("top_panel"),t=e.children;t[16].value="Eagle's Manual",t[16].setAttribute("onclick","window.open('https://eaglepb2.gitbook.io/pb2-editor-manual/', '_blank');");let n=e.removeChild(t[t.length-1]).outerHTML;function o(t,n,o){let i=document.createElement("input");i.setAttribute("class","field_btn"),i.setAttribute("type","button"),i.setAttribute("value",t),i.setAttribute("onclick",`aleiButtonClicks['${n}']()`),main_window.aleiButtonClicks[n]=o;let a=document.createElement("div");a.setAttribute("class","q"),e.appendChild(i),e.appendChild(a)}n=e.removeChild(t[t.length-1]).outerHTML+n,e.removeChild(t[t.length-1]),main_window.aleiButtonClicks={};let i=document.createElement("div");i.setAttribute("class","q3"),e.appendChild(i),o("Download XML","downloadXMLButton",exportXML),o("Insert XML","insertXMLButton",(()=>{if(confirm("File (OK) or text (Cancel) ?")){let e=document.createElement("input");e.type="file",e.onchange=function(){if(e.files[0])if("xml"==e.files[0].name.split(".")[1]){let t=new FileReader;t.onload=function(){insertXML(t.result),e.remove()},t.readAsText(e.files[0])}else alert("Invalid file extension.")},e.click()}else{let e=prompt("Enter XML:","");null!==e&&insertXML(e)}})),o("ALEI Settings","openALEISettings",showSettings),e.innerHTML+=n,main_window.mapid_field=$id("mapid_field"),mapid_field.value=mapid}function addClipboardSync(){let e=new BroadcastChannel("ale_clipboard");e.onmessage=t=>{let n=t.data,o=n.kind;if("send"==o){let e=n.recipient,t=n.clip_name,o=n.clip_data;null!=e&&e!=aleiSessionID||(aleiLog(DEBUG,"/ale_clipboard/ got data for "+t),sessionStorage[t]=o)}if("get"==o){if(aleiSessionID>Math.min(...aleiSessionList))return;let t=n.session_id;aleiLog(DEBUG,"/ale_clipboard/ syncing to "+t);for(let n=0;n<=10;n++){let o="clipboard"+(0==n?"":"_slot"+(n-1)),i=sessionStorage[o];null!=i&&e.postMessage({kind:"send",recipient:t,clip_name:o,clip_data:i})}}},aleiLog(DEBUG,"/ale_clipboard/ requesting"),e.postMessage({kind:"get",session_id:aleiSessionID});let t=main_window.CopyToClipBoard;main_window.CopyToClipBoard=n=>{t(n);let o=sessionStorage[n];e.postMessage({kind:"send",clip_name:n,clip_data:o})}}async function addSessionSync(){let e=new BroadcastChannel("ale_session");e.onmessage=t=>{let n=t.data,o=n.kind;if("start"==o){if(null==aleiSessionID)return;e.postMessage({kind:"greet",id:aleiSessionID}),aleiLog(DEBUG,"/ale_session/ recieved start")}if("greet"==o){let e=n.id;aleiSessionList.includes(e)||aleiSessionList.push(e),aleiLog(DEBUG,"/ale_session/ received greet by "+e)}if("close"==o){let e=n.id;aleiSessionList.splice(aleiSessionList.indexOf(e),1),aleiLog(DEBUG,"/ale_session/ received close by "+e)}},e.postMessage({kind:"start"}),aleiLog(DEBUG,"/ale_session/ probing"),await new Promise((e=>{JS_setTimeout(e,200)})),aleiSessionID=0==aleiSessionList.length?0:Math.max(...aleiSessionList)+1,aleiLog(DEBUG,"/ale_session/ session ID "+aleiSessionID),main_window.addEventListener("beforeunload",(t=>{e.postMessage({kind:"close",id:aleiSessionID})})),addClipboardSync()}function addPropertyPanelResize(){let e=!1;const t=document.createElement("div"),n=document.documentElement;t.style.position="absolute",t.style.width="5px",t.style.top="50px",t.style.height="100%",t.style.cursor="w-resize",$id("floattag").appendChild(t),t.addEventListener("mousedown",(t=>{e=!0})),n.addEventListener("mouseup",(t=>{e=!1,writeStorage("ALEI_RightPanelWidth",right_panel.clientWidth+"px")})),n.addEventListener("mousemove",(o=>{e&&function(e){let o=Math.min(n.clientWidth-100,Math.max(100,n.clientWidth-e.clientX));right_panel.style.width=o+"px",t.style.right=o+"px",ROOT_ELEMENT.style.setProperty("--param_panel_size",t.style.right),updateBoxSplitterSize()}(o)})),t.style.right=aleiSettings.rightPanelSize,ROOT_ELEMENT.style.setProperty("--param_panel_size",t.style.right),main_window.splitter=t}function addTriggerIDs(){if(!aleiSettings.showTriggerIDs)return;let e=VAL_TABLE.trigger_type;for(let t in e)e[t]=t+" "+e[t]}function patchShowHideButton(){let e=main_window.ShowHideObjectBox;main_window.ShowHideObjectBox=function(){e();let t=$id("rparams"),n={true:270,false:155}[ObjectBox_visible];null!=t&&(n=Math.round(t.getBoundingClientRect().top+13)),document.documentElement.style.setProperty("--ALEI_RPARAMS_HEIGHT",`calc(100vh - ${n}px)`)},ShowHideObjectBox(),ShowHideObjectBox()}function addSnappingOptions_helper(){$query('a[onmousedown="GridSnappingSet(50);"]').remove(),$query('a[onmousedown="GridSnappingSet(100);"]').remove();let e="",t=[1,2,5,10,20,40,50,100,"C"];for(let n in t){let o=t[n];n%3==0&&0!=n&&(e+="<br>");let i=document.createElement("a");i.innerHTML="C"!=o?o/10:"C";let a="tool_btn";GRID_SNAPPING==o&&(a="tool_btn2"),t.includes(GRID_SNAPPING)||"C"!=o||(a="tool_btn2"),i.setAttribute("class",`${a} tool_wid`),i.setAttribute("style","width: 21px;"),"C"!=o?i.setAttribute("onmousedown",`GridSnappingSet(${o}); Render();`):i.setAttribute("onmousedown","ALEI_CustomSnapping(); Render();"),e+=i.outerHTML}$query('a[onmousedown="GridSnappingSet(10);"]').outerHTML=e}function addRematchUIOptions_helper(){$query("a[onmousedown=\"EvalSet('param_panel_size',800);SaveBrowserSettings();UpdateCSS();\"]").remove();let e=document.evaluate("//span[contains(., 'Param')]",left_panel,null,XPathResult.ANY_TYPE,null);e.iterateNext(),e.iterateNext().innerHTML="Remap UID";for(let e of[[!0,"Yes",0],[!1,"No",200]]){let t=document.createElement("a");t.innerHTML=e[1];let n="tool_btn";aleiSettings.rematchUID==e[0]&&(n="tool_btn2"),t.setAttribute("class",`${n} tool_wid`),t.setAttribute("style","width: 64px;"),t.setAttribute("onmousedown",`ALEI_UpdateRematchUIDSetting(${e[0]})`),$query(`a[onmousedown="EvalSet('param_panel_size',${e[2]});SaveBrowserSettings();UpdateCSS();"]`).outerHTML=t.outerHTML}}function addPreviewNamesOptions_helper(){let e=$query('a[onmousedown="ShowTexturesSet(true);"]'),t=document.createElement("span");t.setAttribute("class","gui_sel_info"),t.innerHTML="Object Names";let n="";function o(e,t){let o=document.createElement("a"),i="tool_btn";t==aleiSettings.renderObjectNames&&(i="tool_btn2"),o.setAttribute("class",`tool_wid ${i}`),o.setAttribute("style","width: 32px"),o.setAttribute("onmousedown",`ALEI_UpdateNameRenderSetting(${t});`),o.innerHTML=e,n+=o.outerHTML}o("Show",!0),o("Hide",!1),e.outerHTML+='<br><div class="q"></div><br>'+t.outerHTML+"<br>"+n}function onToolUpdate(){addSnappingOptions_helper(),addRematchUIOptions_helper(),addPreviewNamesOptions_helper()}function patchUpdateTools(){let e=UpdateTools;main_window.UpdateTools=function(){e(),onToolUpdate()},UpdateTools(),aleiLog(DEBUG,"Patched updateTools.")}function tryToNumber(e){return isNaN(Number(e))?e:Number(e)}function insertXML(e){e="<map>"+e.replaceAll("&","[__Amp]")+"</map>";let t=(new DOMParser).parseFromString(e,"application/xml").querySelectorAll("*");for(let e=1;e<t.length;e++){let n=t[e];if("map"==n.tagName)continue;let o=new E(n.tagName);o.pm={};for(let e=0;e<n.attributes.length;e++){let t=n.attributes[e].name,i=n.attributes[e].value;o.pm[t]=tryToNumber(i.replaceAll("[__Amp]","&"))}es.push(o)}need_redraw=1,need_GUIParams_update=1}function exportXML(){let e=0,t="",n=document.createElement("a");for(let t=0;t<es.length;t++)es[t].selected&&(e=1);if(e){if(!confirm("Only selection will be exported."))return;for(let e=0;e<es.length;e++)es[e].selected&&(t+=compi_obj(e));mapid?n.download=mapid+" (selection).xml":n.download="newmap (selection).xml"}else{for(let e=0;e<es.length;e++)es[e].exists&&(t+=compi_obj(e));mapid?n.download=mapid+".xml":n.download="newmap.xml"}n.href="data:text,"+escape(t),""!=t?(n.href="data:text,"+escape(t),n.click()):alert("Map is empty."),n.remove()}main_window.ALEI_CustomSnapping=()=>{let e=prompt("Enter snapping:","");if(e){if(!isNaN(Number(e)))return e<.1?(e=.1,void NewNote("ALEI: Snapping can't be less than 0.1","#FF0000")):e>100?(e=100,void NewNote("ALEI: Snapping can't be greater than 100","#FF0000")):void GridSnappingSet(Math.round(10*e));NewNote("Invalid snapping.","#FF0000")}},main_window.ALEI_UpdateRematchUIDSetting=function(e){e&&!OCM_LOADED&&aleiSettings.ocmEnabled&&CreateConnectionMapping(),!e&&OCM_LOADED&&aleiSettings.ocmEnabled&&CreateConnectionMapping(),aleiSettings.rematchUID=e,writeStorage("ALEI_RemapUID",e),UpdateTools()},main_window.ALEI_UpdateNameRenderSetting=function(e){main_window.ENABLE_TEXT=e,aleiSettings.renderObjectNames=e,writeStorage("ALEI_RenderObjectNames",e),UpdateTools(),need_redraw=1};const _ignoredKeys=["x","y","w","h","maxcalls","command","upg","tox","toy","stab","damage","u","v","sx","sy","r","f","power","enabled","flare","uid","gun_model","model"];function UUIDR_Replace(e,t,n){if("string"!=typeof e)return e;if(-1===e.indexOf(t))return e;if(e==t)return n;let o=e.split(",");for(let e=0;e<o.length;e++){let i=o[e];i.trim()==t&&(o[e]=i.replace(t,n))}return o.join(",")}function updateUIDReferences(e,t){aleiLog(DEBUG2,`Updating UID references from ${ANSI_CYAN}${e}${ANSI_RESET} to ${ANSI_CYAN}${t}${ANSI_RESET}`);for(let n=0;n<es.length;n++){let o=es[n];if(!o.exists)continue;let i=o.pm;for(let n of Object.entries(i)){let o=n[0],a=n[1];if(-1===_ignoredKeys.indexOf(o))if(-1===["additionalParamA","additionalParamB"].indexOf(o))i[o]=UUIDR_Replace(a,e,t);else for(let n=0;n<a.length;n++)a[n]=UUIDR_Replace(a[n],e,t)}}main_window.need_GUIParams_update=!0}function __OCM_EnsureValidReferences(e){let t=main_window.ObjectConnectionMapping,n=main_window.uidToElementMap,o=e.pm;if(void 0===t[o.uid])return;let i=[];function a(e){-1===i.indexOf(e)&&i.push(e)}for(let e of Object.keys(o)){if(-1===__OCM_CHECKED_KEYS.indexOf(e))continue;let t=o[e];void 0===n[t]||a(t)}function r(e,t){if("string"!=typeof t)return;if(void 0!==n[t])return void a(t);if(!t.includes(","))return;let o=t.split(",");for(let e of o){let t=e.trim();void 0!==n[t]&&a(t)}}if("trigger"==e._class){for(let e=1;e<11;e++)-1!=o[`actions_${e}_type`]&&void 0!==o[`actions_${e}_type`]&&(r(o.uid,o[`actions_${e}_targetA`]),r(o.uid,o[`actions_${e}_targetB`]));if(o.extended&&aleiSettings.extendedTriggers){let e=o.additionalActions,t=o.additionalParamA,n=o.additionalParamB;for(let i=0;i<e.length;i++)-1!==e[i]&&(r(o.uid,t[i]),r(o.uid,n[i]))}}let l=t[o.uid].to;for(let e of i)-1===l.indexOf(e)&&__OCM_AddReference(o.uid,e);for(let e of l)-1===i.indexOf(e)&&__OCM_RemoveReference(o.uid,e)}function UpdatePhysicalParam(e,t,n=!0){lcz();var o=!1,i="";let a=main_window.es;main_window.es=SelectedObjects;for(var r=0;r<es.length;r++){if(!es[r].exists)continue;if(!es[r].selected)continue;if(!es[r].pm.hasOwnProperty(e)&&!es[r].pm.extended)continue;if(!MatchLayer(es[r])){o=!0;continue}let l=/actions_(\d+)_(targetA|targetB|type)/g,s=Array.from(e.matchAll(l))[0],c="string"==typeof e?'"'+e+'"':e;if(t="number"==typeof t||0==t?t:_encodeXMLChars(`${t}`),!s||Number(s[1])-11<0){if(lnd("es["+r+"].pm["+c+"] = "+es[r].pm[e]+";"),ldn("es["+r+"].pm["+c+"] = "+t+";"),"uid"==e&&aleiSettings.rematchUID){let d=es[r].pm[e];if(main_window.es=a,void 0!==main_window.uidToElementMap[t])return void NewNote(`ALEI: Object with name ${t} already exists, consider naming it differently.`,"#FFFF00");if(updateUIDReferences(d,t),aleiSettings.ocmEnabled){let p=main_window.ObjectConnectionMapping;function m(e,t,n){let o=p[e].to.indexOf(t);-1!==o&&(p[e].to[o]=n),o=p[e].by.indexOf(t),-1!==o&&(p[e].by[o]=n)}p[t]=p[d],delete p[d],p[t].by.map((e=>m(e,d,t))),p[t].to.map((e=>m(e,d,t)))}a=main_window.es,main_window.es=SelectedObjects}"__id"==e&&NewNote("ALEI: Changing Object ID does not do anything, don't expect that to apply.","#FFFFFF"),es[r].pm[e]=t,"__priority"==e&&ApplyObjectProperties(es[r])}else{let u=Number(s[1])-11,_="";if("type"===s[2])_="additionalActions";else if("targetA"===s[2])_="additionalParamA";else{if("targetB"!==s[2])return void aleiLog(WARN,"Something went wrong with regex. "+s[2]);_="additionalParamB"}lnd(`es["${r}"].pm["${_}"][${u}] = ${es[r].pm[_][u]};`),ldn(`es["${r}"].pm["${_}"][${u}] = ${t};`),es[r].pm[_][u]=t}aleiSettings.ocmEnabled&&__OCM_EnsureValidReferences(es[r]),"uses_timer"==e&&(-1!=[!0,"true"].indexOf(es[r].pm.uses_timer)?param_type[REGION_EXECUTE_PARAM_ID][1]="timer+none":param_type[REGION_EXECUTE_PARAM_ID][1]="trigger+none",need_GUIParams_update=!0),i+='Parameter "'+e+'" of object "'+(null!=es[r].pm.uid?es[r].pm.uid:es[r]._class)+'" was set to "'+t+'"<br>'}need_redraw=!0,n&&NewNote("Operation complete:<br><br>"+i,note_passive),o&&NewNote("Note: Some changes weren't made due to missmatch of active layer and class of selected objects",note_neutral),lfz(!1),main_window.es=a}let imageContextMap={},last_element,last_login;function ImageContext(e,t,n,o,i,a=!1,r="?",l="?",s=!1){imageContextMap[e]=n,last_element=o,last_login=r,t.preventDefault();var c=document.getElementById("image_context"),d="";return i?(d+=`<div onclick="CloseImageContext(); setTimeout( function() { ServerRequest('a=get_images&for_class='+last_for_class+'&approve_for=${e}', 'approve_image' ); }, 1 );">Approve <img src="../images/ap.png" width="11" height="11"></div>`,d+=`<div onclick="CloseImageContext(); setTimeout( function() { ServerRequest('a=get_images&for_class='+last_for_class+'&reset_status_for=${e}', 'reset_approval_image' ); }, 1 );">Reset approval status</div>`,d+=`<div onclick="CloseImageContext(); setTimeout( function() { open_approved_decor_model = true; SaveFiltering(); search_phrase = '*by_login*'+last_login; UpdateImageList(); }, 1 );">Search for other approved images from &quot;${r}&quot;</div>`,d+=`<div onclick="" style="color:rgba(0,0,0,0.3)">Last status change by ${l}</div>`,d+=`<div onclick="CloseImageContext(); setTimeout( function() { ServerRequest('a=get_images&for_class='+last_for_class+'&disapprove_for_all='+last_login, 'disapprove_image' ); }, 1 );">Disapprove all unreviewed from &quot;${r}&quot; <img src="../images/noap.png" width="11" height="11"><img src="../images/noap.png" width="11" height="11"><img src="../images/noap.png" width="11" height="11"></div>`,d+=`<div onclick="CloseImageContext(); setTimeout( function() { ServerRequest('a=get_images&for_class='+last_for_class+'&disapprove_for=${e}', 'disapprove_image' ); }, 1 );">Disapprove <img src="../images/noap.png" width="11" height="11"></div>`):(r==curlogin&&"!"!=l?(d+=`<div onclick="aleiContextRenameImage(${e})">Rename</div>`,a?(d+='<div onclick="" style="color:rgba(0,0,0,0.3)">Request Approval (already done)</div>',d+=`<div onclick="CloseImageContext();  setTimeout( function() { ServerRequest('a=get_images&for_class='+last_for_class+'&deawait_approval_for=${e}', 'await_approval_status' ); }, 1 ); ">Exclude from approval review queue</div>`):(d+="Untitled"==n?'<div onclick="alert(\'Proper name required for custom image - you will not be available to change name once image is approved.\');" style="color:rgba(0,0,0,0.3)">Request Approval (proper name required)</div>':`<div onclick="CloseImageContext();  setTimeout( function() { ServerRequest('a=get_images&for_class='+last_for_class+'&await_approval_for=${e}', 'await_approval_status' ); }, 1 ); ">Request Approval <img src="../images/ap.png" width="11" height="11"></div>`,d+='<div onclick="" style="color:rgba(0,0,0,0.3)">Exclude from approval review queue (not in queue)</div>'),d+=`<div onclick="aleiContextDeleteImage(${e})">Delete <img src="../images/noap.png" width="11" height="11"></div>`):d+=`<div onclick="CloseImageContext(); setTimeout( function() { open_approved_decor_model = true; SaveFiltering(); search_phrase = '*by_login*'+last_login; UpdateImageList(); }, 1 );">Search for other approved images from &quot;${r}&quot;</div>`,d+='<span style="display:block;">&nbsp;</span>',d+=s?`<div onclick="CloseImageContext();  setTimeout( function() { ServerRequest('a=get_images&for_class='+last_for_class+'&favorite_del=${e}', 'favorite_status' ); }, 1 ); ">Remove from favorites</div>`:`<div onclick="CloseImageContext();  setTimeout( function() { ServerRequest('a=get_images&for_class='+last_for_class+'&favorite_add=${e}', 'favorite_status' ); }, 1 ); ">Add to favorites</div>`),c.innerHTML=d,c.style.left=t.clientX,c.style.top=t.clientY,c.style.display="block",image_context_cancel_pad.style.display="block",!1}function findObjects(e){let t=confirm("Exact name?"),n=1;for(let i=0;i<es.length;i++)es[i].selected=0,es[i].pm.uid&&(o=es[i].pm.uid,(t?o==e:o.includes(e))&&MatchLayer(es[i])&&(es[i].selected=1,n=0));var o;return need_GUIParams_update=1,need_redraw=1,n}function rotateObjects(){let e,t,n=SelectedObjects,o=[],i=[];for(let e=0;e<n.length;e++){if(n[e].pm.w&&n[e].pm.h){let t=n[e].pm.w;n[e].pm.w=n[e].pm.h,n[e].pm.h=t}o.push(n[e].pm.x),i.push(n[e].pm.y)}e=Math.min(...o),t=Math.min(...i);for(let a=0;a<n.length;a++)o[a]-=e,i[a]-=t,n[a].pm.x=e+i[a],n[a].pm.y=t+o[a]}function RandomizeName(e){let t=es.filter((e=>e.exists)).map((e=>e.pm.uid)),n=e;-1!==e.indexOf("*")&&(n=e.slice(0,e.indexOf("*")));let o=1;for(;-1!==t.indexOf(`${n}*${o}`);)o++;return`${n}*${o}`}function patchRandomizeName(){main_window.RandomizeName=RandomizeName}function patchAllowedCharacters(){allowed_string_chars+="<>"}function getRuleBySelector(e){let t,n=document.styleSheets[0].rules;for(let o=0;o<n.length;o++)n[o].selectorText==e&&(t=n[o]);return t}function setStyle(e,t,n,o=!1){o||blackThemeUndos.push([e,t,getRuleBySelector(e).style[t]]),getRuleBySelector(e).style[t]=n}function UndoBlackTheme(){ThemeSet(0);for(let e of blackThemeUndos)setStyle(e[0],e[1],e[2],!0)}function blackTheme(){ThemeSet(0),main_window.THEME=4,setStyle(".topui","backgroundSize","0px"),setStyle(".leftui","backgroundSize","0px"),setStyle(".rightui","backgroundSize","0px"),setStyle(".topui","backgroundColor","#0A0A0A"),setStyle(".leftui","backgroundColor","#0A0A0A"),setStyle(".rightui","backgroundColor","#0A0A0A"),setStyle(".field_btn","backgroundColor","#1E1E1E"),setStyle(".tool_btn","backgroundColor","#1E1E1E"),setStyle(".tool_btn","border",""),setStyle(".tool_btn2","backgroundColor","#4566AB"),setStyle(".tool_btn2","border","1px solid #FFFFFF20"),setStyle(".field_btn","color","#FFFFFFD0"),setStyle(".tool_btn","color","#FFFFFFD0"),setStyle(".tool_btn2","color","#FFFFFFD0"),setStyle(".gui_sel_info","color","#FFFFFFD0"),setStyle(".c","color","#FFFFFF20"),setStyle(".pa1","color","#808080"),setStyle(".pa2","color","#FFFFFFD0"),setStyle(".field_dis_left","color","#FFFFFFD0"),setStyle(".field_dis_right","color","#FFFFFFD0"),setStyle(".p_u1","border",""),setStyle(".p_u2","border",""),setStyle(".pa1","backgroundColor","#101010"),setStyle(".pa2","backgroundColor","#1B1B1B"),setStyle(".objbox","backgroundColor","#131313"),setStyle(".field_dis_left","backgroundColor","#1E1E1E"),setStyle(".field_dis_right","backgroundColor","#131313"),setStyle(".selline1","backgroundColor","#7A1314"),setStyle(".tool_btn:hover","backgroundColor","#5f8dd3"),setStyle(".tool_btn:hover","border","1px solid #FFFFFF20"),setStyle(".tool_btn:hover","color","#FFFFFFD0"),setStyle(".tool_btn2:hover","backgroundColor","#5077C4"),setStyle(".tool_btn2:hover","border","1px solid #FFFFFF20"),setStyle(".tool_btn2:hover","color","#FFFFFFD0"),setStyle(".field_btn:hover","backgroundColor","#353535"),setStyle(".field_btn:hover","color","#FFFFFFD0"),setStyle(".tool_btn:active","backgroundColor","#151515"),setStyle(".tool_btn:active","border","1px solid #FFFFFF20"),setStyle(".tool_btn:active","color","#FFFFFFD0"),setStyle(".tool_btn2:active","backgroundColor","#39558C"),setStyle(".tool_btn2:active","border","1px solid #FFFFFF20"),setStyle(".tool_btn2:active","color","#FFFFFFD0"),setStyle(".field_btn:active","backgroundColor","#151515"),setStyle(".field_btn:active","color","#CCC"),setStyle("#mrtitle","backgroundColor","#1E1E1E"),setStyle("#mrbox","backgroundColor","#0A0A0A"),setStyle(".field_input","backgroundColor","#131313"),setStyle(".field_input","color","#CCC"),setStyle(".btn","backgroundColor","#1E1E1E"),setStyle(".btn","color","#CCC"),setStyle(".btn:hover","backgroundColor","#353535"),setStyle(".btn:hover","color","#CCC"),setStyle(".btn:active","backgroundColor","#151515"),setStyle(".btn:active","color","#CCC"),setStyle("closebox","backgroundColor","#353535"),setStyle("closebox","color","#CCC"),setStyle(".list_group","backgroundColor","#1E1E1E"),setStyle(".list_group","borderBottom",""),setStyle(".list_group:hover","backgroundColor","#353535"),setStyle(".list_group:active","backgroundColor","#0A0A0A"),setStyle(".image_list_collapsable","backgroundColor","#0A0A0A"),setStyle(".img_option_selected","backgroundColor","#4566AB40"),setStyle(".rightui","borderLeft",""),setStyle(".leftui","borderRight",""),setStyle("::-webkit-scrollbar-thumb","backgroundColor","#888"),setStyle("#rparams, #gui_objbox, #tools_box, #parambox","scrollbarColor",""),setStyle("#rparams, #gui_objbox, #tools_box, #parambox","scrollbarWidth",""),setStyle("#tools_box","overflow-y","hidden"),setStyle("#tools_box","overflow-y","auto")}function getObjectBox(e){let t=0,n=0,o=e.pm.w,i=e.pm.h;return"box door region pushf bg water".includes(e._class)||(t=bo_x[e._class],n=bo_y[e._class],o=bo_w[e._class],i=bo_h[e._class]),"player enemy".includes(e._class)&&(t=-15,n=-81,o=30,i=80),"vehicle"==e._class&&(t=bo_x["vehicle_"+e.pm.model],n=bo_y["vehicle_"+e.pm.model],o=bo_w["vehicle_"+e.pm.model],i=bo_h["vehicle_"+e.pm.model],"veh_hh"==e.pm.model&&(t=lo_x.alei_veh_hh,n=lo_y.alei_veh_hh,o=lo_w.alei_veh_hh,i=lo_h.alei_veh_hh)),{x:t,y:n,w:o,h:i}}function getSelectionImage(){let e=SelectedObjects,t=1/0,n=1/0,o=-1/0,i=-1/0;for(let a=0;a<e.length;a++){let r=getObjectBox(e[a]),l=e[a].pm.x+r.x,s=e[a].pm.y+r.y,c=r.w,d=r.h;l<t&&(t=l),l+c>o&&(o=l+c),s<n&&(n=s),s+d>i&&(i=s+d)}main_window.es=[];for(let t of e)es.push(t);THEME=4,GRID_ALPHA=0,SHOW_CONNECTIONS=0,zoom=1,zoom_validate();let a=dis_to_x-dis_from_x,r=dis_to_y-dis_from_y;dis_from_x=t-10,dis_from_y=n-10,dis_to_x=t+a-10,dis_to_y=n+r-10,ConsoleTraceMessages=[],Render();let l=o-t+20,s=i-n+20;aleiLog(DEBUG2,"Before GID");let c=ctx.getImageData(0,0,l,s);aleiLog(DEBUG2,"After GID");let d=document.createElement("canvas"),p=d.getContext("2d"),m=document.createElement("canvas"),u=m.getContext("2d");d.width=l,d.height=s,p.beginPath(),p.putImageData(c,0,0),p.closePath();let _=l,g=s;if(l>100||s>100){let e=l/s;e>=1?(l=100,s=l/e):(s=100,l=s*e)}m.width=l,m.height=s,u.beginPath(),u.scale(l/_,s/g),u.drawImage(d,0,0),u.closePath();let h=m.toDataURL();return d.remove(),d=void 0,h}function createClipboardDiv(){let e=document.createElement("div"),t=document.getElementById("mrdimlights");e.id="clipboardDiv",e.className="mrpopup",e.style="width: calc(100% - 280px); height: 100%; margin: 0px; padding: 0px; top: 50%; transform: translate(0px, -50%); display: none;",e.addEventListener("contextmenu",(e=>{e.preventDefault()})),t.addEventListener("click",(t=>{e.style.display="none"})),document.body.append(e)}function clipboardItemAction(e){let t=JSON.parse(localStorage.clipboardItems);if(confirm("Rename (OK) or delete (Cancel) ?")){let n=prompt("Enter name:",t[e].name);n&&(t[e].name=n,localStorage.clipboardItems=JSON.stringify(t),updateClipboardDiv())}else confirm("Are you sure you want to delete?")&&(t.splice(e,1),localStorage.clipboardItems=JSON.stringify(t),updateClipboardDiv())}function registerClipboardItemAction(){main_window.clipboardItemAction=clipboardItemAction,aleiLog(DEBUG,"Registered Clipboard Item Action")}function updateClipboardDiv(){localStorage.clipboardItems||(localStorage.clipboardItems="[]");let e=JSON.parse(localStorage.clipboardItems),t=document.getElementById("clipboardDiv"),n=document.getElementById("mrdimlights");t.style.display="block",n.style.display="block";let o='\n        <div id="mrtitle">\n            <span>Object clipboard</span>\n            <closebox onclick="document.getElementById(\'clipboardDiv\').style.display = \'none\'; document.getElementById(\'mrdimlights\').style.display = \'none\';">x</closebox>\n        </div>\n\n        <div id="mrbox" class="objbox" style="height: calc(100% - 32px); box-sizing: border-box;">\n    ',i=main_window.es,a={};a.theme=THEME,a.grid_opacity=GRID_ALPHA,a.showConnections=SHOW_CONNECTIONS,a.dtx=dis_to_x,a.dty=dis_to_y,a.dfx=dis_from_x,a.dfy=dis_from_y,a.ctm=ConsoleTraceMessages,a.zoom=zoom,main_window.es=[];for(let t=0;t<e.length;t++)__pasteObjectClipboard(e[t]),o+='\n            <div class="img_option" style="width: auto;" oncontextmenu="clipboardItemAction('+t+')" onclick="pasteFromPermanentClipboard('+t+');">\n                <img src="'+getSelectionImage()+'" style="max-width: 100px; max-height: 100px;">\n                <div>'+e[t].name+"</div>\n            </div>\n        ";t.innerHTML=o+"</div>",main_window.es=i,THEME=a.theme,GRID_ALPHA=a.grid_opacity,SHOW_CONNECTIONS=a.showConnections,dis_to_x=a.dtx,dis_to_y=a.dty,dis_from_x=a.dfx,dis_from_y=a.dfy,ConsoleTraceMessages=a.ctm,zoom=a.zoom,need_redraw=1,zoom_validate()}function __pasteObjectClipboard(e){sessionStorage.permanent_clipboard=e.data,PasteFromClipBoard("permanent_clipboard")}function pasteFromPermanentClipboard(e){let t=JSON.parse(localStorage.clipboardItems);sessionStorage.permanent_clipboard=t[e].data,PasteFromClipBoard("permanent_clipboard");let n=document.getElementById("clipboardDiv"),o=document.getElementById("mrdimlights");n.style.display="none",o.style.display="none",NewNote("Objects pasted from permanent clipboard.",note_passive)}function copyToPermanentClipboard(){try{if(0!=SelectedObjects.length){CopyToClipBoard("permanent_clipboard");let e=JSON.parse(localStorage.clipboardItems);e.push({name:"Selection",data:sessionStorage.permanent_clipboard}),localStorage.clipboardItems=JSON.stringify(e),NewNote("Objects copied to permanent clipboard.",note_passive)}else updateClipboardDiv()}catch(e){console.error(e),NewNote("Can't copy objects to permanent clipboard.<br>LocalStorage error?",note_bad)}}function changeTopRightText(){let e=document.getElementById("version_rights"),t=e.childNodes[0];e.style.width="170px",t.style.width="160px";let n="";isNative&&(n=" v"+GM_info.script.version),t.innerHTML=t.innerHTML.replaceAll("<br>"," ")+"<br>ALE Improvements"+n}function addAdditionalButtons(){const e=document.getElementById("rparams"),t=SelectedObjects;if(!e||1!=t.length)return;const n='<a onclick="getImageSize();" class="tool_btn tool_wid" style="display: block; width: 100%; margin-top: 4px;">Get image size</a>';if("bg"==t[0]._class&&(e.innerHTML+=n),"decor"==t[0]._class&&(e.innerHTML+=n,e.innerHTML+='<a onclick="centerImageX();" class="tool_btn tool_wid" style="display: block; width: 100%; margin-top: 4px;">Center decoration X</a>',e.innerHTML+='<a onclick="centerImageY();" class="tool_btn tool_wid" style="display: block; width: 100%; margin-top: 4px;">Center decoration Y</a>'),!edit_triggers_as_text&&"trigger"==t[0]._class&&ExtendedTriggersLoaded){const t='\n            <div class="two-element-grid">\n                <a onclick="addTriggerActionCount(1)" class="tool_btn tool_wid" style="display: block; width: 95%; margin-top: 4px;">(+) Extend trigger action list.</a>\n                <a onclick="addTriggerActionCount(-1)" class="tool_btn tool_wid" style="display: block; width: 95%; margin-top: 4px;">(-) Shrink trigger action list.</a>\n            </div>\n\n            <div class="two-element-grid">\n                <div class="two-element-grid">\n                    <a onclick="addTriggerActionCount(5)" class="tool_btn tool_wid" style="display: block; width: 90%; margin-top: 4px;">(+5)</a>\n                    <a onclick="addTriggerActionCount(10)" class="tool_btn tool_wid" style="display: block; width: 90%; margin-top: 4px;">(+10)</a>\n                </div>\n\n                <div class="two-element-grid">\n                    <a onclick="addTriggerActionCount(-5)" class="tool_btn tool_wid" style="display: block; width: 90%; margin-top: 4px;">(-5)</a>\n                    <a onclick="addTriggerActionCount(-10)" class="tool_btn tool_wid" style="display: block; width: 90%; margin-top: 4px;">(-10)</a>\n                </div>\n            </div>\n        ';e.innerHTML+=t,StreetMagic()}}function addTriggerActionCount(e){const t=SelectedObjects;if(1!=t.length||0===e)return;const n=t[0];if(!n.pm.extended&&e<0)return;n.pm.extended||(n.pm.additionalActions=new Array,n.pm.additionalParamA=new Array,n.pm.additionalParamB=new Array,n.pm.totalNumOfActions=10,n.pm.extended=!0,NewNote("Converted this to an extended trigger.",note_passive),NewNote("Be mindful about your number of triggers.",note_neutral),NewNote("Behind the scenes, this creates 1 trigger for every additional 9 trigger actions.",note_neutral),-1!=n.pm.maxcalls&&NewNote("Non-infinite call triggers are not supported by ALEI extended triggers design. You won't be able to save this map until you change max calls to be infinite.",note_neutral)),n.pm.totalNumOfActions+=e,n.pm.totalNumOfActions<=10||isNaN(n.pm.totalNumOfActions)?(delete n.pm.additionalActions,delete n.pm.additionalParamA,delete n.pm.additionalParamB,delete n.pm.totalNumOfActions,delete n.pm.extended):e>0?(n.pm.additionalActions.push(...Array(e).fill(-1)),n.pm.additionalParamA.push(...Array(e).fill(0)),n.pm.additionalParamB.push(...Array(e).fill(0))):(n.pm.additionalActions.length+=e,n.pm.additionalParamA.length+=e,n.pm.additionalParamB.length+=e),UpdateGUIParams();let o=document.getElementById("rparams");o.scrollTop=o.scrollHeight}function getImageSize(){let e,t=SelectedObjects;if("bg"==t[0]._class&&(e=t[0].pm.m),"decor"==t[0]._class&&(e=t[0].pm.model),"string"==typeof e){let t=document.createElement("img");t.onload=function(){let e=t.width,n=t.height;t.remove(),alert("W: "+e+"\nH: "+n)},t.onerror=function(){t.remove(),alert("Image not found.")},t.src="https://www.plazmaburst2.com/mimage_cache.php?image_id="+e.slice(1)}else alert("Image not found.")}function getImageData(){return new Promise(((e,t)=>{let n,o=SelectedObjects;if("bg"==o[0]._class&&(n=o[0].pm.m),"decor"==o[0]._class&&(n=o[0].pm.model),"string"==typeof n){let t=document.createElement("img");t.onload=function(){let n=t.width,o=t.height,i=document.createElement("canvas"),a=i.getContext("2d");i.width=t.width,i.height=t.height,a.beginPath(),a.drawImage(t,0,0),a.closePath(),e([a.getImageData(0,0,n,o).data,n])},t.onerror=function(){t.remove(),alert("Image not found."),e(1)},t.src="https://www.plazmaburst2.com/mimage_cache.php?image_id="+n.slice(1)}else alert("Image not found."),e(1)}))}function arrMin(e){let t=1/0;for(let n=0;n<e.length;n++)e[n]<t&&(t=e[n]);return t}function arrMax(e){let t=-1/0;for(let n=0;n<e.length;n++)e[n]>t&&(t=e[n]);return t}function getImagePosition(e,t){let n,o,i,a,r=[],l=[],s=0,c=0;if(1!=e){for(let n=0;n<e.length;n+=4)if(e[n+3]>=3){let e=n/4%t,o=Math.floor(n/4/t);r.push(e),l.push(o)}n=arrMin(r),o=arrMin(l),i=arrMax(r),a=arrMax(l),s=(n+i)/2,c=(o+a)/2}return{x:s,y:c}}function setDecorOffset(e,t){let n=SelectedObjects;n[0].pm.u=e,n[0].pm.v=t}function centerImageX(){let e=SelectedObjects;1==e.length&&"decor"==e[0]._class&&getImageData().then((t=>{1!=t&&setDecorOffset(-getImagePosition(t[0],t[1]).x,e[0].pm.v)})),need_redraw=1,need_GUIParams_update=1}function centerImageY(){let e=SelectedObjects;1==e.length&&"decor"==e[0]._class&&getImageData().then((t=>{if(1!=t){let n=getImagePosition(t[0],t[1]).y;setDecorOffset(e[0].pm.u,-n)}})),need_redraw=1,need_GUIParams_update=1}function addFunctionToWindow(){main_window.getImageSize=getImageSize,main_window.centerImageX=centerImageX,main_window.centerImageY=centerImageY,main_window.addTriggerActionCount=addTriggerActionCount}main_window.aleiContextRenameImage=function(e){var t=prompt("New name:",imageContextMap[e]);CloseImageContext(),null!==t&&ServerRequest(`a=get_images&for_class=${last_for_class}&set_title_for=${e}&value=${t}`,"rename_image")},main_window.aleiContextDeleteImage=function(e){let t=confirm(`Are you sure you want to delete ${imageContextMap[e]} ?`);CloseImageContext(),t&&(last_element.style.opacity="0.5",ServerRequest(`a=get_images&for_class=${last_for_class}&delete=${e}`,"delete_image"))},main_window.blackThemeUndos=[];let newUpdate=0,targetElement;function doTooltip(){let e=document.createElement("p");e.id="alei-tooltip",document.body.append(e),document.addEventListener("mousemove",(t=>{t.target.title&&(t.target.dataset.title=t.target.title,t.target.title=""),t.target.parentElement.title&&(t.target.parentElement.dataset.title=t.target.parentElement.title,t.target.parentElement.title="");let n=150;if(t.target.dataset.title){let o=t.target.dataset.title.length;e.style.left=o+n+t.clientX+20+"px",e.innerHTML=t.target.dataset.title,31!=e.getBoundingClientRect().height&&(e.style.left=o+n+t.clientX-20-e.getBoundingClientRect().width+"px")}else if(t.target.parentElement.dataset.title){let o=t.target.parentElement.dataset.title.length;e.style.left=o+n+t.clientX+20+"px",e.style.top=t.clientY+"px",e.innerHTML=t.target.parentElement.dataset.title,31!=e.getBoundingClientRect().height&&(e.style.left=o+n+t.clientX-20-e.getBoundingClientRect().width+"px")}else e.style.left="50px",e.style.top="-100px"})),aleiLog(DEBUG,"Added tooltip.")}function patchDecorUpload(){let e=$id("imageLoader");e.setAttribute("multiple",!0),e.removeEventListener("change",handleImage),e.addEventListener("change",(function(e){let t=e.target.files;NewNote(`ALEI: Will upload ${t.length} bg/decor(s).`,"#2595FF");for(let e of t)handleImage({target:{files:[e]}})}),!1)}function setParameter(e,t){let n=document.getElementById("rparams");if(null==n)return;if(null==n)return;if(e>13){if(-1!==SelectedObjects.map((e=>"trigger"==e._class)).indexOf(!1))return;if(e>=3*Math.min(...SelectedObjects.map((e=>{return(t=e).isExtended?t.pm.totalNumOfActions:10;var t})))+Trigger_getSeparatorStart(SelectedObjects.length)-1)return}let o=0,i=0;for(;i<e;)i++,o++,null!=n.childNodes[o]&&void 0===n.childNodes[o].childNodes[1]&&o++;o<n.childNodes.length&&(n.childNodes[o].childNodes[1].innerHTML=t)}function getSelection(){return SelectedObjects}function areObjectsOfSameType(e){let t=1;for(let n=0;n<e.length;n++)e[n]._class!=e[0]._class&&(t=0);return t}function removeSameItems(e){return Array.from(new Set(e))}function removeItems(e,t){let n=JSON.parse(JSON.stringify(e));for(let e=0;e<t.length;e++)n.splice(n.indexOf(t[e]),1);return n}function parameterNamesToIndexes(e,t){let n=[];for(let o=0;o<e.length;o++)n.push(t.indexOf(e[o]));return n}function getSameParameters(e){let t=[],n=Object.keys(e[0].pm);for(let o=0;o<e.length;o++)for(let i=0;i<n.length;i++)e[o].pm[n[i]]!=e[0].pm[n[i]]&&t.push(n[i]);return t=removeSameItems(t),t=removeItems(n,t),parameterNamesToIndexes(t,n)}function toBoolean(e){return isNaN(Number(e))?"true"==e:Boolean(e)}document.addEventListener("mousedown",(e=>{targetElement=e.target})),document.addEventListener("keydown",(e=>{if(e.ctrlKey&&"KeyA"==e.code&&canvas_focus&&main_window.es.map((e=>{e.exists&&e._isphysical&&MatchLayer(e)&&(e.selected=!0),main_window.need_redraw=!0,main_window.need_GUIParams_update=!0})),e.ctrlKey&&"KeyS"==e.code&&canvas_focus&&(e.preventDefault(),document.getElementsByClassName("field_btn")[0].click()),e.ctrlKey&&"KeyF"==e.code&&canvas_focus){e.preventDefault();let t=prompt("Find objects:","");null!==t&&""!==t&&findObjects(t)&&alert("Nothing found.")}if("KeyR"==e.code&&"[object HTMLInputElement]"!=targetElement&&"opcode_field"!=targetElement.id&&(isOnlyTriggerSelected()||rotateObjects()),e.ctrlKey&&"KeyR"==e.code&&canvas_focus&&isOnlyTriggerSelected()&&!isNothingSelected()&&(e.preventDefault(),reverseTriggerActions(),unselectTriggerActions()),("Minus"==e.code||"NumpadSubtract"==e.code)&&e.ctrlKey&&canvas_focus&&(e.preventDefault(),zoom*=2,zoom_validate(),need_redraw=1),("Equal"==e.code||"NumpadAdd"==e.code)&&e.ctrlKey&&canvas_focus&&(e.preventDefault(),zoom*=.5,zoom_validate(),need_redraw=1),e.ctrlKey&&e.altKey&&(e.preventDefault(),zoom=1,zoom_validate(),need_redraw=1),"KeyH"==e.code&&e.ctrlKey&&(e.preventDefault(),"opcode_field"===targetElement.id)){let e=targetElement.value,t=prompt("Enter string to replace from:","");if(!t)return;let n=prompt("Enter string to replace to:",t);if(!n)return;targetElement.value=e.replaceAll(t,n)}if("Enter"==e.code&&"[object HTMLInputElement]"!=targetElement&&"opcode_field"!=targetElement.id&&canvas_focus){let e=SelectedObjects;if(0!=e.length){let t=prompt("Enter parameter name:","");if(t){let n=prompt("Enter expression:","");if(n){t=t.toLowerCase().replace("width","w").replace("height","h");for(let o=0;o<e.length;o++){let i=e[o].pm.x,a=e[o].pm.y,r=e[o].pm.w,l=e[o].pm.h;if(void 0===i&&(i=0),void 0===a&&(a=0),void 0===r&&(r=0),void 0===l&&(l=0),void 0!==e[o].pm[t]){let s=(0,_alescript_js__WEBPACK_IMPORTED_MODULE_7__.q)(n,[i,a,r,l,o]);if("number"==typeof s){for(let t=0;t<e.length;t++)e[t].selected=0;e[o].selected=1,UpdatePhysicalParam(t,s)}for(let t=0;t<e.length;t++)e[t].selected=1}}need_GUIParams_update=1}}}}if(e.altKey&&e.preventDefault(),e.altKey&&"[object HTMLInputElement]"==targetElement){let e=SelectedObjects;if(1==e.length){let t=e[0].pm.x,n=e[0].pm.y,o=e[0].pm.w,a=e[0].pm.h;void 0===t&&(t=0),void 0===n&&(n=0),void 0===o&&(o=0),void 0===a&&(a=0);let r=(0,_alescript_js__WEBPACK_IMPORTED_MODULE_7__.q)(targetElement.value,[t,n,o,a,i]);"number"==typeof r&&(targetElement.value=r)}}e.ctrlKey&&"KeyP"==e.code&&(e.preventDefault(),copyToPermanentClipboard()),e.ctrlKey&&e.shiftKey&&newUpdate&&(main_window.open("https://github.com/LisABC/ALEI/raw/main/alei.user.js"),newUpdate=!1)}));const parameterMap={box:{m:"box_model"},door:{moving:"bool",vis:"bool"},region:{use_on:"region_activation"},decor:{f:"draw_in_front",model:"decor_model"},bg:{s:"bool",f:"draw_in_front",m:"bg_model"},water:{friction:"bool"},trigger:{enabled:"bool"},timer:{enabled:"bool"},gun:{command:"team+any",upg:"gun_upgrade",model:"gun_model"},barrel:{model:"barrel_model"},lamp:{flare:"bool"},vehicle:{model:"vehicle_model"}};function fixParameterValue(e,t,n){let o;return o=VAL_TABLE[e]?VAL_TABLE[e][t]:parameterMap[n]&&parameterMap[n][e]?VAL_TABLE[parameterMap[n][e]][t]:"actions_"==e.slice(0,8)&&"_type"==e.slice(-5)?VAL_TABLE.trigger_type[t]:t,o}function setSameParameters(){let e=getSelection();if(areObjectsOfSameType(e)&&e.length>=2){let t=getSameParameters(e),n=Object.keys(e[0].pm);for(let o=0;o<t.length;o++){let i=n[t[o]],a=e[0].pm[n[t[o]]],r=e[0]._class;setParameter(t[o],fixParameterValue(i,a,r))}}}function patchANI(){let e=ani;main_window.ani=function(){let t=need_GUIParams_update;e(),t&&aleiSettings.showSameParameters&&setSameParameters()},aleiLog(DEBUG,"Patched ANI")}function updateBoxSplitterSize(){let e=$id("gui_objbox").getBoundingClientRect(),t=splitter2.style;t.setProperty("width",e.width),t.setProperty("left",e.x),t.setProperty("top",e.bottom)}function addObjBoxResize(){let e=$id("gui_objbox"),t=document.createElement("div");main_window.splitter2=t;let n=t.style;$id("floattag").appendChild(t),n.setProperty("position","absolute"),n.setProperty("height","5px"),n.setProperty("cursor","s-resize"),updateBoxSplitterSize();let o=!1;t.onmousedown=e=>{o=!0},ROOT_ELEMENT.addEventListener("mouseup",(e=>{o=!1})),ROOT_ELEMENT.addEventListener("mousemove",(t=>{if(!o)return;let n=t.clientY-90;e.style.height=n,updateBoxSplitterSize(),ShowHideObjectBox(),ShowHideObjectBox()})),aleiLog(DEBUG,"Added splitter for object box.")}function patch_m_down(){let e=main_window.m_down;main_window.m_down=function(t){let n=es.length;e(t);let o=ObjectConnectionMapping,i=uidToElementMap,a=[];if(es.length>n){let e=es[es.length-1];if(!("x"in e.pm))return;let t=e.pm,r=function(e){return Math.round(e/GRID_SNAPPING)*GRID_SNAPPING};if(t.x=r(t.x),t.y=r(t.y),e._isresizable&&(t.w=r(t.w),t.h=r(t.h)),aleiSettings.ocmEnabled)for(let e=n;e<es.length;e++)o[es[e].pm.uid]={by:[],to:[]},i[es[e].pm.uid]=es[e],a.push(es[e]);main_window.need_GUIParams_update=!0,UpdateGUIObjectsList()}for(let e of a)__OCM_HandleObject(e)}}function ReorderTriggerProperty(e){let t=e.pm.execute;t=t||!1,delete e.pm.execute;let n=Object.entries(e.pm);n.splice(5,0,["execute",t]),e.pm=Object.fromEntries(n)}function patchEntityClass(){setTimeout((function e(){setTimeout(e,5e3);for(let e=0;e<SelectedObjects.length;e++){let t=SelectedObjects[e];t.selected||t.selectChange(!1,!0)}}),5e3);let e=E;main_window.E=function(t){let n=new e(t);return"water"==t?n.pm.attach=-1:"decor"==t?n.pm.text="Hello World!":"trigger"==t?ReorderTriggerProperty(n):"region"==t&&(n.pm.uses_timer=!1),n.fixPos=function(){},n.selectChange=function(e,t=!1){!e||n.selected&&!t?e||!n.selected&&!t||(SelectedObjects.splice(SelectedObjects.indexOf(n),1),n.selected=!1):(SelectedObjects.push(n),n.selected=!0)},n.Remove=()=>{NewNote("ALEI: This absolutely should not happen, please report to ALEI developers, error: E.Remove got called when it shouldn't be","#FF0000")},new Proxy(n,{set:function(e,t,o){return"selected"==t?n.selectChange(o):n[t]=o,!0}})},aleiLog(DEBUG,"Patched entity.")}function PasteFromClipBoard(e){var t=new Object;if(null==sessionStorage[e])return!1;t=unserialize(sessionStorage[e]),lcz();for(var n=0;n<es.length;n++)es[n].exists&&es[n].selected&&(ldn("es["+n+"].selected=false;"),lnd("es["+n+"].selected=true;"),es[n].selected=!1);var o=0,i=0,a=0,r=0;n=0;for(var l=es.length;void 0!==t[n];){var s=es.length;ldn("es["+s+"].exists=true;"),lnd("es["+s+"].exists=false;"),es[s]=new E(t[n]._class);for(let e in t[n])es[s][e]=t[n][e];void 0!==es[s].pm.x&&void 0!==es[s].pm.y&&(0==n?(o=es[s].pm.x,a=es[s].pm.y,i=es[s].pm.x,r=es[s].pm.y,void 0!==es[s].pm.w&&void 0!==es[s].pm.h&&(o+=es[s].pm.w/2,i+=es[s].pm.w/2,a+=es[s].pm.h/2,r+=es[s].pm.h/2)):(o=Math.min(o,es[s].pm.x),a=Math.min(a,es[s].pm.y),i=Math.max(i,es[s].pm.x),r=Math.max(r,es[s].pm.y),void 0!==es[s].pm.w&&void 0!==es[s].pm.h&&(i=Math.max(i,es[s].pm.x+es[s].pm.w),r=Math.max(r,es[s].pm.y+es[s].pm.h)))),n++}ldn("m_drag_selected=true;"),ldn("paint_draw_mode=true;"),ldn("quick_pick_ignore_one_click=true;"),lnd("m_drag_selected=false;"),lnd("paint_draw_mode=false;"),lnd("quick_pick_ignore_one_click=false;"),ldis=!0,paint_draw_mode=!0,quick_pick_ignore_one_click=!0,lmdrwa=lmwa,lmdrwb=lmwb;let c=lmwa,d=lmwb;m_drag_x=mouse_x,m_drag_y=mouse_y;let p=c,m=d;var u=Math.round(c/GRID_SNAPPING)*GRID_SNAPPING,_=Math.round(d/GRID_SNAPPING)*GRID_SNAPPING,g=Math.round((u-(o+i)/2)/GRID_SNAPPING)*GRID_SNAPPING,h=Math.round((_-(a+r)/2)/GRID_SNAPPING)*GRID_SNAPPING;let f=ObjectConnectionMapping,b=uidToElementMap,y=[];for(var A=l;A<es.length;A++){if(void 0!==es[A].pm.uid){var w=es[A].pm.uid;es[A].exists=!0,es[A].pm.uid=RandomizeName(es[A].pm.uid);for(var v=l;v<es.length;v++)for(let e in es[v].pm)es[v].pm[e]=UUIDR_Replace(es[v].pm[e],w,es[A].pm.uid);aleiSettings.ocmEnabled&&(f[es[A].pm.uid]={by:[],to:[]},b[es[A].pm.uid]=es[A],y.push(es[A]))}void 0!==es[A].pm.x&&void 0!==es[A].pm.y&&(lnd("es["+A+"].pm.x="+es[A].pm.x+";"),lnd("es["+A+"].pm.y="+es[A].pm.y+";"),es[A].pm.x+=g,es[A].pm.y+=h,es[A].fixPos(),ldn("es["+A+"].pm.x="+es[A].pm.x+";"),ldn("es["+A+"].pm.y="+es[A].pm.y+";"))}for(u=Math.round((c-p)/GRID_SNAPPING)*GRID_SNAPPING,_=Math.round((d-m)/GRID_SNAPPING)*GRID_SNAPPING,n=0;n<es.length;n++)es[n]._isphysical&&es[n].exists&&es[n].selected&&(MatchLayer(es[n])||paint_draw_mode)&&(es[n].pm.x+=u,es[n].pm.y+=_);p+=u,m+=_,lfz(!1);for(let e of y)__OCM_HandleObject(e);return assignObjectIDs(),assignObjectPriority(),main_window.need_redraw=!0,main_window.need_GUIParams_update=!0,!0}function ServerRequest_handleMapData(e){aleiLog(DEBUG,"Parsing map source now.");const t=/(\w+)=((-?\d+(\.\d+)?)|("[ -~]*")|true|false)/,n=/q=es\[\d+\]=new E\("(\w+)"\)/;let o=e.split(";\n"),i=null;main_window.es=new Array;let a=2;for(;a<o.length;a++){let e=o[a];if(0==e.replaceAll("\n","").replaceAll("\t","").length)continue;if(-1!=e.indexOf("mapid = '")){main_window.mapid=e.split(" = ")[1].slice(1,-1),mapid_field.value=mapid;continue}if("\t\tmapid_field.value = mapid"==e)continue;if(-1!=e.indexOf("maprights.innerHTML='")){let t=e.split(";")[0].split(".innerHTML=")[1].slice(1,-1);maprights.value=t,NewNote(`Map '${mapid}' has been successfully loaded.`,note_good);continue}if(-1!=e.indexOf(";q=q.pm;")){let t=n.exec(e);i=new E(t[1]),es[es.length]=i;let o=e.split(";");if(o.length>3){aleiLog(WARN,`Expected 3 items, got ${o.length} - ${o}`);continue}e=o[2]}let r=t.exec(e);if(null===r){aleiLog(WARN,`Unable to figure out what kind of code is "${e}", you MIGHT have issues.`);continue}let l=r[1],s=r[2].replaceAll("\\/","/");s='"'!=s[0]?"true"==s||"false"!=s&&(-1!=s.indexOf(".")?parseFloat(s):parseInt(s)):s.slice(1,-1).replaceAll("\\'","'"),i.pm[l]=s}aleiSettings.extendedTriggers&&parseExtendedTriggers(),(0,_aleimapdata_aleimapdata_js__WEBPACK_IMPORTED_MODULE_2__.Or)(),(0,_aleimapdata_aleimapdata_js__WEBPACK_IMPORTED_MODULE_2__.zj)()}function handleServerRequestResponse(e,t,n){if(-1!=n.indexOf("var es = new Array();"))main_window.SelectedObjects=[],OCM_LOADED=!1,ServerRequest_handleMapData(n),CreateConnectionMapping();else if(-1!==n.indexOf("knownmaps = [")){main_window.knownmaps=[];for(let e of n.match(/"(.*?)"/g))knownmaps.push(e.slice(1,-1));aleiLog(DEBUG,`Updated knownmaps with ${knownmaps.length} maps`)}else{aleiLog(DEBUG2,`Evaling for request ${ANSI_YELLOW}"${e}"${ANSI_RESET} with operation of ${ANSI_YELLOW}"${t}"${ANSI_RESET}: ${n}`);try{JS_eval(n)}catch(o){NewNote("Eval error!",note_bad),console.error(o),aleiLog(INFO,`Eval Error from ${e}, for op ${t} whose response is ${n}`)}}}function makeRequest(e,t,n){return new Promise((function(o,i){let a=new XMLHttpRequest;a.open(e,t),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onload=function(){this.status>=200&&this.status<300?o({status:200,response:a.response}):i({status:this.status,statusText:a.statusText})},a.onerror=function(){i({status:this.status,statusText:a.statusText})},a.send(n)}))}function updateDecorList(){try{let e=$id("list_native");for(let t=0;t<ALEI_decors.length;t++){let n=ALEI_decors[t],o=n[0],i=n[1],a=n[2];e.innerHTML+=`\n                    <div class="img_option" onClick="CustomImageSelected('${o}', '${i}' )">\n                       <div class="imgdiv" style="background:url(${a})"></div>\n                       <div>\n                         ${i}\n                       </div>\n                    </div>\n                    `}aleiLog(DEBUG,"Updated decor list.")}catch(e){}}async function ALEI_ServerRequest(e,t,n=null){let o=await makeRequest("POST",`e_server.php?a=${request_a}`,e);if(200==o.status){try{handleServerRequestResponse(e,t,o.response),-1!=e.indexOf("a=get_images")&&-1!=e.indexOf("for_class=decor_model")&&updateDecorList(),main_window.ImageContext=ImageContext,"save"!=t&&"load"!=t||(changes_made=!1,"load"==t&&(need_redraw=!0,need_GUIParams_update=!0,ClearUndos()))}catch(e){console.error(e),NewNote("Server responds with unclear message. Looks like one of recent actions wasn't successful.",note_bad)}null!=n&&n()}else"save"==t?NewNote("Oops! Error occoured during saving. Usually it may be happening due to connection problems. Map will be temporary saved to your computer's LocalStorage",note_bad):"load"==t&&NewNote("Oops! Error occoured durning loading. Usually it may be happening due to connection problems.",note_bad)}main_window.SelectedObjects=[];let _serverRequestPatched=!1;function patchServerRequest(){_serverRequestPatched||(_serverRequestPatched=!0,main_window.ServerRequest=ALEI_ServerRequest,main_window.eval=JS_eval,aleiLog(DEBUG,"Patched ServerRequest"))}function assignObjectIDs(){let e={};for(let t of es)t.exists&&(void 0===e[t._class]&&(e[t._class]=-1),e[t._class]+=1,t.aleiID=e[t._class])}function assignObjectPriority(){for(let e of es)e.exists&&null==e.aleiPriority&&(e.aleiPriority=1)}main_window.eval=function(e){void 0!==main_window.ServerRequest?(handleServerRequestResponse(null,null,e),patchServerRequest()):console.log(e)};let propertyAppliedObjects=[];function AssignObjectProperties(e){null==e.aleiID&&assignObjectIDs(),null==e.aleiPriority&&assignObjectPriority(),-1==propertyAppliedObjects.indexOf(e)&&propertyAppliedObjects.push(e);let t=Object.entries(e.pm);t.splice(0,0,["__id",e.aleiID]),-1!==["bg","decor"].indexOf(e._class)&&t.splice(1,0,["__priority",e.aleiPriority]),e.pm=Object.fromEntries(t)}let sortRequired=!1;function SortObjectsByPriority(){main_window.es=es.sort((function(e,t){return t.aleiPriority-e.aleiPriority}))}function ApplyObjectProperties(e){-1!=["bg","decor"].indexOf(e._class)&&e.aleiPriority!==e.pm.__priority&&(e.aleiPriority=e.pm.__priority,sortRequired=!0)}function RemoveObjectProperties(e){delete e.pm.__id,delete e.pm.__priority}function patchUpdateGUIParams(){let oldCodeSnippet="if ( i >= 4 && (i-4) % 3 == 0 ) {",newCodeSnippet="if (shouldAddSeparatorInGUIParams(i)) {",code=main_window.UpdateGUIParams.toString().replace(oldCodeSnippet,newCodeSnippet);code.includes(newCodeSnippet),code="("+code+")";let origUGP=eval(code),origGPV=main_window.GenParamVal;main_window.shouldAddSeparatorInGUIParams=e=>{let t=Trigger_getSeparatorStart(SelectedObjects.length);return e>=t&&(e-t)%3==0},main_window.GenParamValEscapeDoubleQuotes=!1,main_window.GenParamVal=function(e,t){return GenParamValEscapeDoubleQuotes&&"nochange"==e?`<pvalue real="${`${t}`.replaceAll('"',"&quot;")}">- not used -</pvalue>`:origGPV(e,t)},main_window.UpdateGUIParams=function(){GenParamValEscapeDoubleQuotes=!0;let e=SelectedObjects;e.filter((e=>"trigger"==e._class)).map((e=>ReorderTriggerProperty(e)));for(let t of propertyAppliedObjects)-1===e.indexOf(t)&&(RemoveObjectProperties(t),propertyAppliedObjects.splice(propertyAppliedObjects.indexOf(t),1));if(e.map((e=>AssignObjectProperties(e))),1==e.length&&"region"==e[0]._class&&(-1!=[!0,"true"].indexOf(e[0].pm.uses_timer)?param_type[REGION_EXECUTE_PARAM_ID][1]="timer+none":param_type[REGION_EXECUTE_PARAM_ID][1]="trigger+none"),origUGP(),addAdditionalButtons(),!edit_triggers_as_text&&1==e.length&&"trigger"==e[0]._class){(0,_comments_commenttextarea_js__WEBPACK_IMPORTED_MODULE_4__.Gg)(e[0]);const t=document.getElementById("rparams");(0,_comments_commenttextarea_js__WEBPACK_IMPORTED_MODULE_4__.gI)(t);const n=(0,_comments_commentdata_js__WEBPACK_IMPORTED_MODULE_8__.Wq)(e[0]);for(const e of n){const n=e+1,o=t.querySelector(`#pm_actions_${n}_type`);if(null===o)continue;const i=o.parentElement,a=(0,_comments_commenttextarea_js__WEBPACK_IMPORTED_MODULE_4__.Db)(e),r=document.createElement("div");r.style.height="2px",t.insertBefore(a,i),t.insertBefore(r,i),(0,_comments_commenttextarea_js__WEBPACK_IMPORTED_MODULE_4__.Fd)(a)}}(0,_paramsidebuttons_paramsidebuttons_js__WEBPACK_IMPORTED_MODULE_5__.R)(),GenParamValEscapeDoubleQuotes=!1,sortRequired&&SortObjectsByPriority()},aleiLog(DEBUG,"Patched UpdateGUIParams")}function patchEvalSet(){main_window.EvalSet=function(e,t){main_window[e]=t,UpdateTools()},aleiLog(DEBUG,"Patched EvalSet")}function createALEISettingsMenu(){let e=document.createElement("div");e.setAttribute("class","mrpopup");let t=document.createElement("div");t.innerHTML="ALEI Setting",t.setAttribute("id","mrtitle"),e.appendChild(t);let n=document.createElement("div");n.setAttribute("id","mrbox"),e.appendChild(n);let o=240,i=300;function a(e,t=!1){let a=document.createElement("div");a.innerHTML=e,t&&a.style.setProperty("color","#FFFF00"),a.setAttribute("class","ALEI_settingMenuText"),n.innerHTML+="<br>",n.innerHTML+=a.outerHTML,o-=20,o<=0&&(i+=20,o+=20,n.style.height=`${i}px`)}function r(e,t,n){aleiSettingButtonsMap[e]=[t,aleiSettings,n]}function l(e,t,o,i=""){aleiButtonClicks["setting_"+t]=o;let a=document.createElement("input");a.setAttribute("type","button"),a.setAttribute("id","ALEI_"+t),a.setAttribute("value",e),a.setAttribute("onclick",`aleiButtonClicks['setting_${t}'](); ALEI_settingUpdateButtons(); triggerActionsPreventError();`),a.setAttribute("class","ALEI_settingsMenuButton"),a.setAttribute("style",i),n.innerHTML+=a.outerHTML}function s(e,t,n,o,i,a=()=>{}){function r(e){writeStorage(n,e),aleiSettings[o]=e}l(e,`${i}_true`,(()=>{r(!0),a(!0)})),l(t,`${i}_false`,(()=>{r(!1),a(!1)}))}n.innerHTML+="NOTE: Settings in yellow text requires page refresh to be applied.<br>",l("Clear Backup","clearMapBackups",(()=>{let e=[];for(let t of Object.keys(localStorage))"pb2_map"==t.slice(0,7)&&(e.push(t),localStorage.removeItem(t));NewNote(`ALEI: Cleared backup, removed total ${e.length} backups.`,"#00FFFF"),aleiLog(DEBUG2,`Removed backup of: ${e}`)}),"width: 100px"),n.innerHTML+="<br>";let c=0;function d(e,t,n,o){c++,function(e,t,n,o){aleiSettingButtonsMap[e]=[t,n,o]}(c,o.map((e=>e[1])),t,n);for(let i of o)l(i[0],`${c}_${i[1]}`,(()=>{return o=i[1],writeStorage(e,o),void(t[n]=o);var o}))}function p(e,t,n,o,i){a(e,t),d(n,aleiSettings,o,i)}main_window.ALEIAPI.settings={},main_window.ALEIAPI.settings.addText=a,main_window.ALEIAPI.settings.createButtons=d;let m=[["Show",!0],["Hide",!1]];p("Log Level:",!1,"ALEI_LogLevel","logLevel",[["INFO",0],["DEBUG",1],["VERBOSE",2]]),p("Action IDs:",!0,"ALEI_ShowTriggerIDs","showTriggerIDs",m),p("Tooltips:",!1,"ALEI_ShowTooltips","enableTooltips",m),p("Same Parameters:",!1,"ALEI_ShowSameParameters","showSameParameters",m),r("blackTheme",[!0,!1],"blackTheme"),a("Black theme:",!1),s("Yes","No","ALEI_BlackTheme","blackTheme","blackTheme",(e=>{e?blackTheme():UndoBlackTheme()})),p("Grid by snap:",!1,"ALEI_gridBasedOnSnapping","gridBasedOnSnapping",[["Yes",!0],["No",!1]]),r("showObjectNames",[!0,!1],"renderObjectNames"),a("Show object names: "),s("Yes","No","ALEI_RenderObjectNames","renderObjectNames","showObjectNames",(e=>ALEI_UpdateNameRenderSetting(e))),r("remapUID",[!0,!1],"rematchUID"),a("Remap UID: "),s("Enabled","Disabled","ALEI_RemapUID","rematchUID","remapUID",(e=>ALEI_UpdateRematchUIDSetting(e))),p("Extended triggers:",!0,"ALEI_ExtendedTriggersEnabled","extendedTriggers",[["Enabled",!0],["Disabled",!1]]),p("Ordered Naming:",!0,"ALEI_orderedNaming","orderedNaming",[["Yes (Slow)",!0],["No (Fast)",!1]]),p("Custom Renderer:",!0,"ALEI_Renderer_Enabled","customRenderer",[["Enabled",!0],["Disabled",!1]]),main_window.ALEI_settingsMenu=e,document.body.appendChild(e),ALEI_settingUpdateButtons(),aleiLog(DEBUG,"Created settings window.")}main_window.ALEI_settingsMenu=void 0;let aleiSettingButtonsMap={};function showSettings(){void 0===ALEI_settingsMenu&&createALEISettingsMenu(),mrdimlights.style.display="block",ALEI_settingsMenu.style.display="block",dim_undo="ALEI_settingsMenu.style.display = 'none'"}function patchTeamList(){for(let e of Object.entries(VAL_TABLE.team)){let t=parseInt(e[0]),n=e[1];t<0&&(n=n.replace("(no friendly fire)","(No collision, Yes friendly fire)"),VAL_TABLE.team[t]=n),-1!==t&&(VAL_TABLE["team+any"][t]=n)}aleiLog(DEBUG,"Edited team list..")}function addProjectileModels(){let e=VAL_TABLE.ALEI_projectileModels={1:"https://static.miraheze.org/plazmaburstwiki/6/6a/Lazer_1.png",2:"https://static.miraheze.org/plazmaburstwiki/a/ae/Lazer_2.png",3:"https://static.miraheze.org/plazmaburstwiki/0/06/Lazer_3.png",4:"https://static.miraheze.org/plazmaburstwiki/d/de/Lazer_4.png",5:"https://static.miraheze.org/plazmaburstwiki/8/8f/Lazer_5.png",6:"https://static.miraheze.org/plazmaburstwiki/a/a0/Lazer_6.png",7:"https://static.miraheze.org/plazmaburstwiki/7/71/Lazer_7.png",8:"https://static.miraheze.org/plazmaburstwiki/c/c6/Lazer_8.png",9:"https://static.miraheze.org/plazmaburstwiki/d/d2/Lazer_9.png",10:"https://static.miraheze.org/plazmaburstwiki/5/5b/Lazer_10.png",11:"https://static.miraheze.org/plazmaburstwiki/d/d2/Lazer_11.png",12:"https://static.miraheze.org/plazmaburstwiki/2/2d/Lazer_12.png",13:"https://static.miraheze.org/plazmaburstwiki/b/be/Lazer_13.png",14:"https://static.miraheze.org/plazmaburstwiki/1/14/Lazer_14.png",15:"",16:"https://static.miraheze.org/plazmaburstwiki/7/7f/Lazer_16.png",17:"https://static.miraheze.org/plazmaburstwiki/3/31/Lazer_17.png",18:"https://static.miraheze.org/plazmaburstwiki/8/89/Lazer_18.png",19:"https://static.miraheze.org/plazmaburstwiki/f/fe/Lazer_19.png",20:"https://static.miraheze.org/plazmaburstwiki/1/1a/Lazer_20.png",21:"https://static.miraheze.org/plazmaburstwiki/4/42/Lazer_21.png",22:"https://static.miraheze.org/plazmaburstwiki/c/c0/Lazer_22.png",23:"https://static.miraheze.org/plazmaburstwiki/d/d9/Lazer_23.png",24:"https://static.miraheze.org/plazmaburstwiki/f/f5/Lazer_24.png",25:"https://static.miraheze.org/plazmaburstwiki/7/7c/Lazer_25.png",26:"https://static.miraheze.org/plazmaburstwiki/a/a7/Lazer_26.png",27:"https://static.miraheze.org/plazmaburstwiki/3/30/Lazer_27.png",28:"https://static.miraheze.org/plazmaburstwiki/3/3a/Lazer_28.png",29:"https://static.miraheze.org/plazmaburstwiki/9/90/Lazer_29.png",30:"https://static.miraheze.org/plazmaburstwiki/2/23/Lazer_30.png",31:"https://static.miraheze.org/plazmaburstwiki/3/3a/Lazer_31.png",32:"https://static.miraheze.org/plazmaburstwiki/f/f0/Lazer_32.png",33:"https://static.miraheze.org/plazmaburstwiki/0/0d/Lazer_33.png",34:"https://static.miraheze.org/plazmaburstwiki/c/c8/Lazer_34.png",35:"https://static.miraheze.org/plazmaburstwiki/3/38/Lazer_35.png",36:"https://static.miraheze.org/plazmaburstwiki/6/6d/Lazer_36.png",37:"https://static.miraheze.org/plazmaburstwiki/a/a9/Lazer_37.png",38:"https://static.miraheze.org/plazmaburstwiki/e/e7/Lazer_38.png",39:"https://static.miraheze.org/plazmaburstwiki/6/6c/Lazer_39.png",40:"https://static.miraheze.org/plazmaburstwiki/d/d4/Lazer_40.png",41:"https://static.miraheze.org/plazmaburstwiki/5/5d/Lazer_41.png",42:"https://static.miraheze.org/plazmaburstwiki/9/9d/Lazer_42.png",43:"https://static.miraheze.org/plazmaburstwiki/7/79/Lazer_43.png",44:"https://static.miraheze.org/plazmaburstwiki/6/6d/Lazer_44.png",45:"https://static.miraheze.org/plazmaburstwiki/4/44/Lazer_45.png",46:"https://static.miraheze.org/plazmaburstwiki/3/3b/Lazer_46.png",47:"https://static.miraheze.org/plazmaburstwiki/8/84/Lazer_47.png",48:"https://static.miraheze.org/plazmaburstwiki/7/75/Lazer_48.png",49:"https://static.miraheze.org/plazmaburstwiki/0/08/Lazer_49.png",50:"https://static.miraheze.org/plazmaburstwiki/4/41/Lazer_50.png",51:"https://static.miraheze.org/plazmaburstwiki/9/92/Lazer_51.png",52:"https://static.miraheze.org/plazmaburstwiki/9/92/Lazer_52.png",53:"https://static.miraheze.org/plazmaburstwiki/7/70/Lazer_53.png",54:"https://static.miraheze.org/plazmaburstwiki/e/ee/Lazer_54.png",55:"https://static.miraheze.org/plazmaburstwiki/d/d1/Lazer_55.png"};for(let t=1;t<56;t++)e[t]=`<img src='${e[t]}' style='width: 60px; height: 20px'/>`;aleiLog(DEBUG,"Loaded projectile models.")}function patchSpecialValue(){let e=main_window.special_value;main_window.special_value=(t,n)=>{if(-1!==["ALEI_projectileModels"].indexOf(t)){let e=VAL_TABLE[t][n];return void 0===e?ERROR_VALUE:e}return"trigger+none"==t?-1==n?VAL_TABLE["trigger+none"][-1]:special_value("trigger",n):"timer+none"==t?-1==n?VAL_TABLE["timer+none"][-1]:special_value("timer",n):e(t,n)},aleiLog(DEBUG,"Patched SpecialValue")}function notifyUpdate(e){newUpdate=1,aleiLog(INFO,`New update: ${e}`),NewNote(`ALEI: There is new update: ${e}, you are currently in ${GM_info.script.version}<br>Press Ctrl + Shift to update`,"#FFFFFF")}function notifyIfTheresUpdate(e){let t,n=e.split("\n");for(let e=0;e<n.length;e++){let o=n[e];if(-1==o.indexOf("@version"))continue;let i=o.split(" ");t=i[i.length-1];break}if(parseInt(t.replaceAll(".",""))>parseInt(GM_info.script.version.replaceAll(".","")))return notifyUpdate(t);aleiLog(INFO,`REMOTE: ${t}, LOCAL: ${GM_info.script.version} => No update detected.`)}async function checkForUpdates(){notifyIfTheresUpdate((await GM.xmlHttpRequest({url:GM_info.script.updateURL}).catch((e=>console.error(e)))).responseText)}function ALEI_DoWorldScale(){var e=prompt("Multiply selection size by % (percents)",100);if(null!=e&&100!=e){var t=Math.floor(e)/100;{let o="/GRID_SNAPPING)*GRID_SNAPPING;";var n=!0;lcz();for(let e=0;e<es.length;e++)es[e].exists&&es[e].selected&&MatchLayer(es[e])&&(null!=es[e].pm.w&&(ldn("es["+e+"].pm.w=Math.round(es["+e+"].pm.w*"+t+o),lnd("es["+e+"].pm.w="+es[e].pm.w+";"),es[e].pm.w*t!=Math.round(es[e].pm.w*t/GRID_SNAPPING)*GRID_SNAPPING&&(n=!1)),null!=es[e].pm.h&&(ldn("es["+e+"].pm.h=Math.round(es["+e+"].pm.h*"+t+o),lnd("es["+e+"].pm.h="+es[e].pm.h+";"),es[e].pm.h*t!=Math.round(es[e].pm.h*t/GRID_SNAPPING)*GRID_SNAPPING&&(n=!1)),null!=es[e].pm.x&&(ldn("es["+e+"].pm.x=Math.round(es["+e+"].pm.x*"+t+o),lnd("es["+e+"].pm.x="+es[e].pm.x+";"),es[e].pm.x*t!=Math.round(es[e].pm.x*t/GRID_SNAPPING)*GRID_SNAPPING&&(n=!1)),null!=es[e].pm.y&&(ldn("es["+e+"].pm.y=Math.round(es["+e+"].pm.y*"+t+o),lnd("es["+e+"].pm.y="+es[e].pm.y+";"),es[e].pm.y*t!=Math.round(es[e].pm.y*t/GRID_SNAPPING)*GRID_SNAPPING&&(n=!1)));lfz(!0),NewNote("Operation complete:<br><br>Selected objects scaled by "+t+" ("+e+"% of original size)",note_passive),n||NewNote("Note: Position and/or dimensions of some objects were not scaled properly due to Level Editor rounding rules",note_neutral),need_GUIParams_update=!0,need_redraw=!0,UpdateTools()}}}function patchPercentageTool(){main_window.DoWorldScale=ALEI_DoWorldScale,aleiLog(DEBUG,"Patched percentage tool")}function _encodeXMLChars(e){return e.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;")}function patchCompileTrigger(){let e=main_window.CompileTrigger;main_window.CompileTrigger=()=>{let t=e(),n=SelectedObjects;for(let e=0;e<n.length;e++){let t=n[e],o=Object.keys(t.pm);for(let e=0;e<o.length;e++)"string"==typeof t.pm[o[e]]&&(t.pm[o[e]]=_encodeXMLChars(t.pm[o[e]]))}return t},aleiLog(DEBUG,"Patched CompileTrigger")}function addPasteFromPermanentClipboard(){main_window.pasteFromPermanentClipboard=pasteFromPermanentClipboard}main_window.ALEI_settingUpdateButtons=()=>{for(let e of Object.entries(aleiSettingButtonsMap)){let t=e[0],n=e[1][0],o=e[1][1][e[1][2]];for(let e of n)$query(`#ALEI_${t}_${e}`).setAttribute("class","ALEI_settingsMenuButton");$query(`#ALEI_${t}_${o}`).setAttribute("class","ALEI_settingsMenuButton ALEI_settingMenuButtonClicked")}};let selectedTriggerActions=[0,0,0,0,0,0,0,0,0,0],hoveredTriggerAction=-1,triggerActionsClipboard=[];function getTriggerActionElements(){let e=[],t=document.getElementsByClassName("p_i"),n=7;for(;n<t.length;n++)e.push(t[n].childNodes[0]);return e}function addEventListeners(){let e=getTriggerActionElements();for(let t=0;t<e.length;t++){let n=e[t];n.onmousedown=function(){selectedTriggerActions[Math.floor(t/3)]^=1,updateTriggerActionElements()},n.onmouseenter=function(){hoveredTriggerAction=Math.floor(t/3),updateTriggerActionElements()},n.onmouseleave=function(){hoveredTriggerAction=-1,updateTriggerActionElements()}}}function updateTriggerActionElements(){let e=getTriggerActionElements();for(let t=0;t<10;t++){let n="";selectedTriggerActions[t]&&(n="rgb(45, 65, 95)",0!=THEME&&(n="rgb(27, 27, 27)")),e[3*t+0].style.backgroundColor=n,e[3*t+1].style.backgroundColor=n,e[3*t+2].style.backgroundColor=n}if(-1!=hoveredTriggerAction&&!selectedTriggerActions[hoveredTriggerAction]){let t="rgb(65, 85, 130)";0!=THEME&&(t="rgb(47, 47, 47)"),e[3*hoveredTriggerAction+0].style.backgroundColor=t,e[3*hoveredTriggerAction+1].style.backgroundColor=t,e[3*hoveredTriggerAction+2].style.backgroundColor=t}}function isOnlyTriggerSelected(){let e=0,t=getSelection();return 1==t.length&&"trigger"==t[0]._class&&(e=1),e}function getTriggerActions(){edit_triggers_as_text=1,UpdateGUIParams();let e=document.getElementById("opcode_field").value.split("\n").slice(4);for(;e.length<10;)e.push("");return edit_triggers_as_text=0,UpdateGUIParams(),e}function copyTriggerActions(){let e=getTriggerActions();triggerActionsClipboard=[];for(let t=0;t<10;t++)selectedTriggerActions[t]&&triggerActionsClipboard.push(e[t])}function isNothingSelected(){return!selectedTriggerActions.includes(1)}function isOnlyOneTriggerActionSelected(){return selectedTriggerActions.indexOf(1)==selectedTriggerActions.lastIndexOf(1)&&!isNothingSelected()}function getSelectedTriggerAction(){return selectedTriggerActions.indexOf(1)}function getTriggerInfo(){return edit_triggers_as_text=1,UpdateGUIParams(),document.getElementById("opcode_field").value.split("\n").slice(0,3)}function pasteTriggerActions(){let e=getTriggerActions(),t=getSelectedTriggerAction(),n=triggerActionsClipboard.join("\n"),o=getTriggerInfo();edit_triggers_as_text=1,UpdateGUIParams(),isNothingSelected()&&(t=e.length-1,e[t]=e[t]+"\n"+n),isOnlyOneTriggerActionSelected()&&(e[t]=n+"\n"+e[t]),document.getElementById("opcode_field").value=o.concat(e).join("\n"),CompileTrigger(),edit_triggers_as_text=0,UpdateGUIParams()}function deleteTriggerActions(){let e=getTriggerActions(),t=getTriggerInfo();edit_triggers_as_text=1,UpdateGUIParams();for(let t=0;t<10;t++)selectedTriggerActions[t]&&(e[t]="");document.getElementById("opcode_field").value=t.concat(e).join("\n"),CompileTrigger(),edit_triggers_as_text=0,UpdateGUIParams()}function reverseTriggerActions(){let e=getTriggerActions(),t=[],n=[],o=getTriggerInfo();edit_triggers_as_text=1,UpdateGUIParams();for(let o=0;o<10;o++)selectedTriggerActions[o]&&(t.push(e[o]),n.push(o));n.reverse();for(let o=0;o<t.length;o++){let i=n[o],a=t[o];e[i]=a}document.getElementById("opcode_field").value=o.concat(e).join("\n"),displayOperationCompleteNotes=!1,CompileTrigger(),displayOperationCompleteNotes=!0,NewNote("Reversed actions.","#FFFFFF"),edit_triggers_as_text=0,UpdateGUIParams()}function unselectTriggerActions(){selectedTriggerActions=[0,0,0,0,0,0,0,0,0,0],hoveredTriggerAction=-1,updateTriggerActionElements()}function patchClipboardFunctions(){let e=CopyToClipBoard,t=PasteFromClipBoard,n=DeleteSelection,o=UpdateGUIParams,i=DO_UNDO,a=DO_REDO;main_window.CopyToClipBoard=function(t){if(isNothingSelected()){let n=e(t);return triggerActionsClipboard=[],n}return copyTriggerActions(),unselectTriggerActions(),!0},main_window.PasteFromClipBoard=function(e){if(0==triggerActionsClipboard.length){let n=t(e);return UpdateGUIParams(),n}return displayOperationCompleteNotes=!1,pasteTriggerActions(),unselectTriggerActions(),displayOperationCompleteNotes=!0,!0},main_window.DeleteSelection=function(){isNothingSelected()?n():(displayOperationCompleteNotes=!1,deleteTriggerActions(),unselectTriggerActions(),NewNote("Deleted trigger actions.","#FFFFFF"),displayOperationCompleteNotes=!0)},main_window.UpdateGUIParams=function(){o(),isOnlyTriggerSelected()?edit_triggers_as_text||(addEventListeners(),updateTriggerActionElements()):(selectedTriggerActions=[0,0,0,0,0,0,0,0,0,0],hoveredTriggerAction=-1)},main_window.DO_UNDO=function(){try{i()}catch(e){NewNote("Can't undo action.",note_bad)}},main_window.DO_REDO=function(){try{a()}catch(e){NewNote("Can't redo action.",note_bad)}},main_window.triggerActionsPreventError=triggerActionsPreventError,aleiLog(DEBUG,"Patched clipboard related functions.")}function patchDrawGrid(){let e=lg;main_window.lg=function(t,n){aleiSettings.gridBasedOnSnapping?e(t*(GRID_SNAPPING/10),Math.min(n*Math.max(GRID_SNAPPING/10,1),1)):e(t,n)},aleiLog(DEBUG,"Patched LG")}function patchNewNote(){let e=NewNote;main_window.NewNote=(t,n)=>displayOperationCompleteNotes||"Operation complete:<br><br>"!=t.slice(0,27)?e(t,n):void 0}function Trigger_getSeparatorStart(e){return 6}function extendTriggerList(){function newUpdateGUIParams(){let e=document.getElementById("rparams"),t=0;e&&(t=e.scrollTop),current_gui_params=new Array,unfocusedit(),ff.style.display="none";var n="",o=0,i=new Array;for(_=0;_<known_class.length;_++)i[_]=0;var a="";for(_=0;_<es.length;_++)es[_].exists&&es[_].selected&&(o++,i[known_class.indexOf(es[_]._class)]++,null!=es[_].pm.uid&&(a.length>0&&(a+=", "),a+='"'+es[_].pm.uid+'"'));var r="",l=0;for(_=0;_<known_class.length;_++)i[_]>0&&(r.length>0&&(r+=", "),l++,r+=i[_]+" "+tonumerous(known_class_title[_],i[_]));l>0&&(1==l&&a.length>0&&(r+=": "+a),r=" ("+r+")",r+=' <a href="#" onclick="ForceDeselect()"><img src="noap.png" width="11" height="11" border="0"></a>'),n+=0==o?'<div id="gui_sel_info" class="gui_sel_info">Nothing selected</div><br><div class="q"></div><br>':1==o?'<div id="gui_sel_info" class="gui_sel_info">'+o+" object selected"+r+'</div><br><div class="q"></div><br>':'<div id="gui_sel_info" class="gui_sel_info">'+o+" objects selected"+r+'</div><br><div class="q"></div><br>';var s=null,c=new Array,d=new Array,p=new Array,m=new Array;let u=Trigger_getSeparatorStart(o);for(var _=0;_<es.length;_++)if(es[_].exists&&es[_].selected){null==s&&(s=es[_]);for(let e in es[_].pm){var g=FindMachingParameterID(e,es[_]._class),h=c.indexOf(g);-1==h&&-1!=g?(c.push(g),d.push(1),p.push(es[_].pm[e]),m.push(e)):d[h]++}}if(edit_triggers_as_text&&1==o&&"trigger"==s._class){n+='<div id="rparams">',n+='<div style="width:220px;white-space:normal;">This feature should not give you much more freedom, yet you might find it useful to copy/paste/cut trigger actions here.</div><br>',n+='<textarea id="opcode_field" class="opcode_field" style="display:block;width:100%;height:400px" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">';var f="";f+="uid: "+s.pm.uid+"\n",f+="enabled: "+s.pm.enabled+"\n",f+="maxcalls: "+s.pm.maxcalls+"\n",f+="execute: "+s.pm.execute+"\n",f+="\n";for(let e=1;e<=10;e++)-1!=s.pm["actions_"+e+"_type"]&&(null==trigger_opcode_aliases[s.pm["actions_"+e+"_type"]]?f+="op"+s.pm["actions_"+e+"_type"]:f+=trigger_opcode_aliases[s.pm["actions_"+e+"_type"]],f+="( ",f+='"'+s.pm["actions_"+e+"_targetA"]+'"',f+=", ",f+='"'+s.pm["actions_"+e+"_targetB"]+'"',f+=" );\n");for(let e=0;aleiSettings.extendedTriggers&&s.pm.extended&&e+11<=s.pm.totalNumOfActions;++e)-1!=s.pm.additionalActions[e]&&(null==trigger_opcode_aliases[s.pm.additionalActions[e]]?f+="op"+s.pm.additionalActions[e]:f+=trigger_opcode_aliases[s.pm.additionalActions[e]],f+="( ",f+='"'+s.pm.additionalParamA[e]+'"',f+=", ",f+='"'+s.pm.additionalParamB[e]+'"',f+=" );\n");n+=f.split("<").join("&lt;").split(">").join("&gt;"),n+="</textarea>",n+='<a class="tool_btn tool_wid" style="width:100%;height:50px;display:block;line-height:50px;" onmousedown="if ( CompileTrigger() ) UpdateGUIParams();">Apply</a><br>'}else{var b,y='<div id="rparams"><div class="p_i"><span class="pa1 p_u1 r_lt">',A=':</span><span class="pa2 p_u2 r_rt" onclick="letedit(this, \'',w=c.length-2;for(_=0;_<c.length;_++)b=1==d[_]?GenParamVal(param_type[c[_]][1],p[_]):"<nochange>...</nochange>",current_gui_params.push(m[_]),n+=y+param_type[c[_]][2]+A+param_type[c[_]][1]+"')\" onMouseOver=\"letover(this, '"+param_type[c[_]][1]+'\')" id="pm_'+param_type[c[_]][0]+'">'+b+"</span></div>","trigger"==s._class&&_>=u&&(_-u)%3==0&&(n+='<div style="height:2px"></div>'),"trigger"!=s._class&&_==w?(y='<div class="p_i"><span class="pa1 p_u0 r_lb">',A=':</span><span class="pa2 p_u0 r_rb" onclick="letedit(this, \''):0==_&&(y='<div class="p_i"><span class="pa1 p_u1">',A=':</span><span class="pa2 p_u2" onclick="letedit(this, \'');if(1==o&&"trigger"==s._class&&s.pm.extended)for(let e=10;e<s.pm.totalNumOfActions;++e){let t=void 0===s.pm.additionalActions[e-10]?-1:s.pm.additionalActions[e-10],o=void 0===s.pm.additionalParamA[e-10]?0:s.pm.additionalParamA[e-10],i=void 0===s.pm.additionalParamB[e-10]?0:s.pm.additionalParamB[e-10];n+=`\n                        <div class="p_i"><span class="pa1 p_u1">\n                        Action '${e+1}' type:\n                        </span><span class="pa2 p_u2 r_rt" onclick="letedit(this, 'trigger_type')" onmouseover="letover(this, 'trigger_type')" id='pm_actions_${e+1}_type'>\n                            <pvalue real='${t}'>\n                            ${special_values_table.trigger_type[t]}\n                            </pvalue>\n                        </span></div>\n\n                        <div class="p_i"><span class="pa1 p_u1">\n                        - parameter A:\n                        </span><span class="pa2 p_u2 r_rt" onclick="letedit(this, 'no_change')" onmouseover="letover(this, 'no_change')" id='pm_actions_${e+1}_targetA'>\n                            <pvalue real='${o}'>\n                            '${o}'\n                            </pvalue>\n                        </span></div>\n\n                        <div class="p_i"><span class="pa1 p_u1">\n                        - parameter B:\n                        </span><span class="pa2 p_u2 r_rt" onclick="letedit(this, 'no_change')" onmouseover="letover(this, 'no_change')" id='pm_actions_${e+1}_targetB'>\n                            <pvalue real='${i}'>\n                            '${i}'\n                            </pvalue>\n                        </span></div>\n\n                        <div style="height:2px"></div>\n                    `}}1==o&&"trigger"==s._class&&(edit_triggers_as_text?n+='<a class="tool_btn tool_wid" style="width:100%;display:block;" onmousedown="edit_triggers_as_text=!edit_triggers_as_text;UpdateGUIParams()">Edit triggers as param list</a>':n+='<a class="tool_btn tool_wid" style="width:100%;display:block;" onmousedown="edit_triggers_as_text=!edit_triggers_as_text;UpdateGUIParams()">Edit triggers as text</a>'),n+="</div>",gui_params.innerHTML=n,e=document.getElementById("rparams"),e&&(e.scrollTop=t),StreetMagic()}function setletedit(val1,val2,defval){const skipTriggerActions=[123,361,364,365];let regex=/actions_(\d+)_(targetA|targetB|type)/g,match=Array.from(lettarget.id.replace("pm_","").matchAll(regex))[0];if(Number(match&&match[1])%9==0&&"type"===match[2]&&skipTriggerActions.includes(Number(val1)))NewNote("Due to how extended triggers is implemented, skip trigger actions are disabled every 9th trigger action. Leave a 'Do Nothing' trigger action here instead.",note_bad);else{if(quick_pick=!1,quick_pick_ignore_one_click=!1,-1!=val1.indexOf("[val]")){defval=Math.abs(Number(defval));var txt=prompt("Enter value:",defval),gotval;gotval=null==txt||""==txt?Math.abs(defval):Math.abs(txt),val1=eval(val1.replace("[val]",gotval)),val2=val2.replace("#",gotval)}else if(-1!=val1.indexOf("[color]")){defval=Math.abs(Number(defval));var gotval=prompt("Enter value in format #XXXXXX:",defval);"#"!=gotval.charAt(0)&&(gotval="#"+gotval),7!=gotval.length&&alert("Value "+gotval+' is not correct. Valid value must be in format #XXXXXX. Read about "hex color codes" for more information.'),val1=val1.replace("[color]",gotval),val2=val2.replace("#",gotval)}ff.value='<pvalue real="'+val1+'">'+val2+"</pvalue>",lettarget.innerHTML=ff.value,ff.style.display="none",ff_drop.style.display="none",letediting=!1,UpdatePhysicalParam(lettarget.id.replace("pm_",""),val1);var parameter_updated=lettarget.id.replace("pm_","");("mark"==parameter_updated||-1!=parameter_updated.indexOf("actions_")&&-1!=parameter_updated.indexOf("_type"))&&StreetMagic()}}function StreetMagic(){var mark_obj=document.getElementById("pm_mark");if(null!=mark_obj){var our_case=mark_pairs["mark_"+innerHTML_to_value(mark_obj.innerHTML)],valobj=document.getElementById("pm_forteam");return null==our_case&&(our_case="nochange"),eval("valobj.onclick = function(e){letedit(this, '"+our_case+"');}"),eval("valobj.onmouseover = function(e){letover(this, '"+our_case+"');}"),void(valobj.innerHTML=GenParamVal(our_case,innerHTML_to_value(valobj.innerHTML)))}let selected=SelectedObjects,totalNumOfActions=10,isTrigger=!1;if(1==selected.length&&"trigger"==selected[0]._class&&(isTrigger=!0,selected[0].pm.extended&&(totalNumOfActions=selected[0].pm.totalNumOfActions)),isTrigger)for(var i=1;i<=totalNumOfActions;i++){var mark_obj=document.getElementById("pm_actions_"+i+"_type");if(null==mark_obj){aleiLog(SWARN,"Failed to retrieve HTML element of property to dynamically apply property type.");break}for(var cases="A",i2=0;i2<2;i2++){var our_case=mark_pairs["trigger_type_"+cases+innerHTML_to_value(mark_obj.innerHTML)],valobj=document.getElementById("pm_actions_"+i+"_target"+cases);null==our_case&&(our_case="nochange"),eval("valobj.onclick = function(e){letedit(this, '"+our_case+"');}"),eval("valobj.onmouseover = function(e){letover(this, '"+our_case+"');}"),valobj.innerHTML=GenParamVal(our_case,innerHTML_to_value(valobj.innerHTML)),cases="B"}}}let oldSaveThisMap=main_window.SaveThisMap;function SaveThisMap(e="",t=null){let n=new Array,o=new Array,i=new Array,a=new Array;for(const e of es){if(!e.exists)continue;if("trigger"!==e._class)continue;if(!e.pm.extended)continue;e.pm.additionalActions.unshift(e.pm.actions_10_type),e.pm.additionalParamA.unshift(e.pm.actions_10_targetA),e.pm.additionalParamB.unshift(e.pm.actions_10_targetB);const t=Math.floor((e.pm.totalNumOfActions-1)/9);let r=e.pm.x+40;const l=e.pm.y;for(let o=0;o<t;o++){let i=`${e.pm.uid}'s extended trigger no: ${o}.`,a=new E("trigger");a.pm.x=r,a.pm.y=l,a.pm.uid=i,0==o&&(e.pm.actions_10_type=99,e.pm.actions_10_targetA=i,a.pm.maxcalls=-1),o<t-1&&(i=`${e.pm.uid}'s extended trigger no: ${o+1}.`,a.pm.actions_10_type=363,a.pm.actions_10_targetA=i);for(let t=1;t<10;t++){let n=9*o+(t-1);a.pm[`actions_${t}_type`]=void 0===e.pm.additionalActions[n]?-1:e.pm.additionalActions[n],a.pm[`actions_${t}_targetA`]=void 0===e.pm.additionalParamA[n]?0:e.pm.additionalParamA[n],a.pm[`actions_${t}_targetB`]=void 0===e.pm.additionalParamB[n]?0:e.pm.additionalParamB[n]}es.push(a),n.push(a),r+=40}o.push(JSON.parse(JSON.stringify(e.pm.additionalActions))),i.push(JSON.parse(JSON.stringify(e.pm.additionalParamA))),a.push(JSON.parse(JSON.stringify(e.pm.additionalParamB))),delete e.pm.additionalActions,delete e.pm.additionalParamA,delete e.pm.additionalParamB}oldSaveThisMap(e,t);let r=0;for(const e of es)e.exists&&"trigger"===e._class&&e.pm.extended&&(e.pm.additionalActions=o[r],e.pm.additionalParamA=i[r],e.pm.additionalParamB=a[r],e.pm.actions_10_type=e.pm.additionalActions.shift(),e.pm.actions_10_targetA=e.pm.additionalParamA.shift(),e.pm.additionalParamB.shift(),r++);for(const e of n)e.exists=!1;UpdateGUIObjectsList()}function CompileTrigger(){const e=[123,361,364,365],t=SelectedObjects;if(1!=t.length)return;const n=t[0];var o=document.getElementById("opcode_field").value.split("\n"),i=[],a=[],r=[];function l(e,t){a.push(e),r.push(t)}for(var s=0;s<o.length;s++){var c=o[s];let e=c.indexOf('( "'),t=c.indexOf('", "'),n=c.indexOf('" );'),a=c.indexOf(":");if(-1!=e&&-1!=t&&-1!=n){var d=c.indexOf("("),p=c.substring(0,d),m=-1;if("op"!=p.substring(0,2)||isNaN(p.slice(2))){if(-1==(m=trigger_opcode_aliases.indexOf(p)))return void NewNote("Error: Changes were not applied because &quot;"+p+"&quot; seems to be an unknown operation code.",note_neutral)}else m=parseInt(p.slice(2));var u="",_="";-1!=m&&(u=c.substring(e+3,t),_=c.substring(t+4,n)),i.push([m,u,_])}else if(-1!=a){for(var g=c.substring(0,a),h=c.slice(a+1);" "==g.charAt(0);)g=g.slice(1);for(;" "==g.charAt(g.length-1);)g=g.slice(0,-1);for(;" "==h.charAt(0);)h=h.slice(1);for(;" "==h.charAt(h.length-1);)h=h.slice(0,-1);if("uid"!=g&&"enabled"!=g&&"maxcalls"!=g&&"execute"!=g)return NewNote("Error: Changes were not applied because &quot;"+g+"&quot; seems to be not a default property.",note_neutral),!1;l(g,h)}else if(""!=c)return NewNote("Error: Changes were not applied because line &quot;"+c+"&quot; wasn't recognized or contains unsupported syntax.",note_neutral),!1}let f=!1;for(let t=0;t<i.length;t++)(t+1)%9==0&&e.includes(i[t][0])&&(i.splice(t,0,[-1,0,0]),f=!0),l("actions_"+(t+1)+"_type",i[t][0]),l("actions_"+(t+1)+"_targetA",i[t][1]),l("actions_"+(t+1)+"_targetB",i[t][2]);for(let e=i.length+1;e<=10;e++)l("actions_"+e+"_type",-1),l("actions_"+e+"_targetA",0),l("actions_"+e+"_targetB",0);f&&NewNote("Skip trigger actions encountered in every 9th trigger action. Inserted an 'Do Nothing' trigger action.",note_neutral),i.length<=10&&n.pm.extended?addTriggerActionCount(-n.pm.totalNumOfActions):n.pm.extended?addTriggerActionCount(i.length-n.pm.totalNumOfActions):addTriggerActionCount(i.length-10);for(let e=0;e<a.length;++e)UpdatePhysicalParam(a[e],r[e],!1);return NewNote("Trigger updated successfully.",note_good),!0}main_window.setletedit=setletedit,main_window.StreetMagic=StreetMagic,main_window.SaveThisMap=SaveThisMap,main_window.CompileTrigger=CompileTrigger,main_window.serialize=JSON.stringify,main_window.unserialize=JSON.parse,main_window.UpdateGUIParams=newUpdateGUIParams}function parseExtendedTriggers(){for(const e of es){if(!e.exists)continue;if("trigger"!==e._class)continue;if(!e.pm.extended)continue;let t=1,n=e.pm.totalNumOfActions;e.pm.totalNumOfActions=9,e.pm.additionalActions=new Array,e.pm.additionalParamA=new Array,e.pm.additionalParamB=new Array;let o=e,i=es.findIndex((e=>e.pm.uid===o.pm.actions_10_targetA&&(363==o.pm.actions_10_type||99==o.pm.actions_10_type)));for(;-1!==i;){let n=es[i];for(let o=1;o<=9;++o)1!==o||1!==t?(e.pm.additionalActions.push(n.pm[`actions_${o}_type`]),e.pm.additionalParamA.push(n.pm[`actions_${o}_targetA`]),e.pm.additionalParamB.push(n.pm[`actions_${o}_targetB`])):(e.pm.actions_10_type=n.pm.actions_1_type,e.pm.actions_10_targetA=n.pm.actions_1_targetA,e.pm.actions_10_targetB=n.pm.actions_1_targetB);if(e.pm.totalNumOfActions+=9,es.splice(i,1),o=n,i=es.findIndex((e=>e.pm.uid===o.pm.actions_10_targetA&&363===o.pm.actions_10_type)),t++,t>1e3){aleiLog(note_bad,"When parsing extended triggers, potentially reached an infinite loop.");break}}if(n){const t=-1;let o=!0;for(let i=n+1;i<e.pm.totalNumOfActions;i++)if(e.pm.additionalActions[i-11]!=t){o=!1;break}if(o){let t=e.pm.totalNumOfActions-n;e.pm.additionalActions.length-=t,e.pm.additionalParamA.length-=t,e.pm.additionalParamB.length-=t,e.pm.totalNumOfActions=n}}}}function updateCSSFile(){const e=document.styleSheets[0];e?e.insertRule(".two-element-grid{ display: grid; justify-content: center; grid-template-columns: 50% 50%; }",0):aleiLog(WARN,"Failed to update CSS file.")}function __OCM_AddReference(e,t){let n=ObjectConnectionMapping;-1===n[e].to.indexOf(t)&&n[e].to.push(t),-1===n[t].by.indexOf(e)&&n[t].by.push(e)}function __OCM_RemoveReference(e,t){let n=ObjectConnectionMapping;-1!==n[e].to.indexOf(t)&&n[e].to.splice(n[e].to.indexOf(t),1),-1!==n[t].by.indexOf(e)&&n[t].by.splice(n[t].by.indexOf(e),1)}function __OCM_HandleObject(e){ObjectConnectionMapping;let t=uidToElementMap;if(void 0===e.pm.uid)return;function n(e,n){if("string"!=typeof n)return;if(void 0!==t[n])return void __OCM_AddReference(e,n);if(0==n.includes(","))return;let o=n.split(",");for(let n of o){let o=n.trim();void 0!==t[o]&&__OCM_AddReference(e,o)}}"#water"===e.pm.uid&&(e.pm.uid=RandomizeName(e.pm.uid));for(let n of Object.keys(e.pm)){if(-1===__OCM_CHECKED_KEYS.indexOf(n))continue;let o=e.pm[n];void 0!==t[o]&&__OCM_AddReference(e.pm.uid,o)}if("trigger"!==e._class)return;let o=e.pm;for(let e=1;e<11;e++)-1!=o[`actions_${e}_type`]&&void 0!==o[`actions_${e}_type`]&&(n(o.uid,o[`actions_${e}_targetA`]),n(o.uid,o[`actions_${e}_targetB`]));if(void 0===o.extended)return;if(!aleiSettings.extendedTriggers)return;let i=o.additionalActions,a=o.additionalParamA,r=o.additionalParamB;for(let e=0;e<i.length;e++)-1!==i[e]&&(n(o.uid,a[e]),n(o.uid,r[e]))}function OCM_onObjectDelete(e){if(!aleiSettings.rematchUID||!aleiSettings.ocmEnabled)return;if(null==e.pm.uid)return;if(!OCM_LOADED)return;let t=e.pm.uid,n=main_window.ObjectConnectionMapping,o=main_window.uidToElementMap;for(n[t].by,n[t].to;0!=n[t].by.length;)__OCM_RemoveReference(n[t].by[0],t);for(;0!=n[t].to.length;)__OCM_RemoveReference(t,n[t].to[0]);0==n[t].by.length&&0==n[t].to.length||NewNote("ALEI: Something is wrong with Object Connection Map. Please regenerate map by loading the map again.","#FF0000"),delete o[t],delete n[t]}function CreateConnectionMapping(){if(OCM_LOADED=!1,main_window.ObjectConnectionMapping={},main_window.uidToElementMap={},!aleiSettings.rematchUID)return;if(!aleiSettings.ocmEnabled)return;let e=ObjectConnectionMapping,t=uidToElementMap;for(let n of es)if(n.exists&&void 0!==n.pm.uid&&"#water"!==n.pm.uid){if(void 0!==e[n.pm.uid])return NewNote(`ALEI: 2+ objects share name ${n.pm.uid}, going to stop constructing object connection map.`,"#FF0000"),void(main_window.ObjectConnectionMapping={});e[n.pm.uid]={by:[],to:[]},t[n.pm.uid]=n}for(let e of es)__OCM_HandleObject(e);OCM_LOADED=!0,aleiLog(DEBUG,"Built object connection map.")}function patchRender(){if(aleiSettings.customRenderer)return void(0,_renderer_user_js__WEBPACK_IMPORTED_MODULE_1__.l)();if(!aleiSettings.blackTheme)return;let fn=ALE_Render.toString();fn=fn.replaceAll("for ( property","for ( let property");let GridColor="#222222",GridLineColor="#FFFFFF50";fn=fn.replace("if ( THEME === THEME_BLUE )",`if (THEME === 4) ctx.fillStyle = '${GridColor}';\n else if (THEME === THEME_BLUE)`),fn=fn.replace("if ( THEME !== THEME_DARK )",`if (THEME === 4) ctx.fillStyle = '${GridLineColor}';\n else if (THEME !== THEME_DARK)`),main_window.Render=eval(`(${fn})`)}function patchDeleteSelection(){let e=main_window.DeleteSelection;main_window.DeleteSelection=()=>{for(let e of SelectedObjects)OCM_onObjectDelete(e);e()}}main_window.triggerActionsPreventError=()=>{selectedTriggerActions=[0,0,0,0,0,0,0,0,0,0],hoveredTriggerAction=-1,UpdateGUIParams()};let alreadyStarted=!1,ALE_start=async function(){if(alreadyStarted)return;alreadyStarted=!0,main_window.ALEIAPI={},VAL_TABLE=special_values_table,ROOT_ELEMENT=document.documentElement,stylesheets=document.styleSheets,ALE_Render=Render,main_window.ObjectConnectionMapping={},main_window.uidToElementMap={},updateCSSFile(),addPropertyPanelResize(),addObjBoxResize(),patchServerRequest(),_loadcss_js__WEBPACK_IMPORTED_MODULE_0__.A(),_loadcss_js__WEBPACK_IMPORTED_MODULE_0__.O(),updateStyles(),updateSkins(),updateSounds(),updateVoicePresets(),updateParameters(),updateOffsets(),updateObjects(),updateButtons(),patch_m_down(),addSessionSync(),addTriggerIDs(),patchShowHideButton(),optimize(),patchUpdateTools(),patchDecorUpload(),patchEntityClass(),patchNewNote(),patchEvalSet(),main_window.UpdatePhysicalParam=UpdatePhysicalParam,main_window.PasteFromClipBoard=PasteFromClipBoard,patchANI(),aleiSettings.enableTooltips&&doTooltip(),aleiSettings.extendedTriggers&&(extendTriggerList(),ExtendedTriggersLoaded=!0),patchUpdateGUIParams(),patchTeamList(),aleiSettings.orderedNaming&&patchRandomizeName(),patchAllowedCharacters(),aleiSettings.blackTheme&&blackTheme(),addProjectileModels(),patchSpecialValue(),UpdateTools(),patchPercentageTool(),patchCompileTrigger(),createClipboardDiv(),addPasteFromPermanentClipboard(),aleiSettings.extendedTriggers||(registerClipboardItemAction(),patchClipboardFunctions()),patchDrawGrid(),addFunctionToWindow(),createALEISettingsMenu(),patchDeleteSelection(),_aleimapdata_aleimapdatapatches_js__WEBPACK_IMPORTED_MODULE_3__.a(),_aleimapdata_aleimapdatapatches_js__WEBPACK_IMPORTED_MODULE_3__.Z(),(0,_comments_commentbuttons_js__WEBPACK_IMPORTED_MODULE_6__.L)(),(0,_comments_commentbuttons_js__WEBPACK_IMPORTED_MODULE_6__.R)(),isNative?checkForUpdates():""!==mapid&&aleiSettings.extendedTriggers&&LoadThisMap(),changeTopRightText(),aleiLog(DEBUG2,"Settings: "+JSON.stringify(aleiSettings)),ALEI_UpdateNameRenderSetting(aleiSettings.renderObjectNames);let e=main_window.PreviewQualitySet;if(main_window.PreviewQualitySet=t=>{e(t),writeStorage("ALEI_PreviewQualitySet",t)},main_window.PreviewQualitySet(readStorage("ALEI_PreviewQualitySet",!1,(e=>"true"===e))),patchRender(),NewNote("ALEI: Welcome!","#7777FF"),NewNote("Don't forget to join discord server! discord.gg/K5jcNEvZ85","#7777FF"),aleiLog(INFO,"Welcome!"),isNative)aleiLog(INFO,`TamperMonkey Version: ${GM_info.version} ALEI Version: ${GM_info.script.version}`);else{let e="You are running ALEI not under tampermonkey, this is not native ALEI, please load ALEI by tampermonkey when possible.";NewNote(`ALEI: ${e}`,"#FFFF00"),NewNote("ALEI: Check https://github.com/LisABC/ALEI for more details.","#FFFF00"),aleiLog(INFO,e),NewNote("ALEI: Reminder that ALEI under tampermonkey is bound to break less than without.","#FFFFFF")}};isNative?document.addEventListener("DOMContentLoaded",(()=>ALE_start())):ALE_start(),console.log("ALEI!")})();